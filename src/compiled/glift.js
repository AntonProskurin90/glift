(function(){var a=window.glift||{};a.createDisplay=function(b){return a.displays.create(b)};a.createController=function(b){return a.controllers.create(b)};a.global={debugMode:!1};window.glift=a})();
glift.util={logz:function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);console.log(""+b);return glift.util.none},beget:function(a){var b=function(){};b.prototype=a;return new b},typeOf:function(a){var b=typeof a;"object"===b&&(a?a instanceof Array&&(b="array"):b="null");return b},isArray:function(a){return a&&"object"===typeof a&&a.constructor===Array},inBounds:function(a,b){return a<b&&0<=a},outBounds:function(a,b){return a>=b||0>a},intersection:function(a,
b){var c={},e;for(e in a)void 0!==b[e]&&(c[e]=1);return c},getKeyWithDefault:function(a,b,c){void 0===a[b]&&(a[b]=c);return a[b]},sizeOf:function(a){var b=0,c;for(c in a)b+=1;return b},varDefined:function(a,b){var c=b||"";if(void 0===a)throw"Argument cannot be undefined"+(""!==c?": "+c:c);},defined:function(){for(var a=0;a<arguments.length;a++)if(void 0===arguments[a])return!1;return!0},assertDefined:function(a,b){if(void 0===a)throw b;return glift.util.none},checkArgsDefined:function(a,b){for(var c=
0;c<b;c++)if(void 0===a[c])throw"Argument "+c+" of "+a.length+" must be defined, but is undefined";return glift.util.none},setMethods:function(a,b){for(var c in b)a[c]=b[c].bind(a);return a}};glift.util.debugl=function(a){glift.debugOn&&glift.util.log(a)};glift.util.log=function(a){("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))&&JSON.stringify(a);void 0!==console&&void 0!==console.log&&console.log(a)};
(function(){var a=function(){this.type="none"};a.prototype={toString:function(){return"None"}};glift.util.none=new a})();glift.util.colors={isLegalColor:function(a){return a===glift.enums.states.BLACK||a===glift.enums.states.WHITE||a===glift.enums.states.EMPTY},oppositeColor:function(a){return a===glift.enums.states.BLACK?glift.enums.states.WHITE:a===glift.enums.states.WHITE?glift.enums.states.BLACK:a}};
glift.enums={states:{BLACK:"BLACK",WHITE:"WHITE",EMPTY:"EMPTY"},directions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},boardRegions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT",ALL:"ALL"},marks:{CIRCLE:"CIRCLE",LETTER:"LETTER",SQUARE:"SQUARE",STONE:"STONE",TRIANGLE:"TRIANGLE",XMARK:"XMARK"},problemResults:{CORRECT:"CORRECT",
INCORRECT:"INCORRECT",INDETERMINATE:"INDETERMINATE"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},controllerTypes:{BASE:"CONTROLLER_BASE",STATIC_PROBLEM_STUDY:"STATIC_PROBLEM_STUDY",DYNAMIC_PROBLEM_STUDY:"DYNAMIC_PROBLEM_STUDY",EXLORE_SOLUTIONS:"EXPLORE_SOLUTIONS",EXLORE_GAME:"EXPLORE_GAME"}};(function(){glift.errors={};glift.errors.ParseError=function(a){this.name="ParseError";this.message=a||""};glift.errors.ParseError.prototype=Error()})();
(function(){glift.logger=function(a,b){return new glift.Log(a,b)};glift.Log=function(a,b){this.name="#"+a;this.num=b;this.curMsgs=0};glift.Log.prototype.println=function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);$("<p>"+b+"</p>").appendTo(this.name);this.curMsgs++;this.curMsgs>this.num&&($(this.name).children("p:first").remove(),this.curMsgs-=1)};glift.Log.prototype.printv=function(){for(var a=arguments,b="",b=a[0],c=1;c<a.length;c++)b=b+","+
a[c];this.println(b)};glift.Log.prototype.log=glift.Log.prototype.println;glift.Log.prototype.printArr=function(a){for(var b=0;b<a.length;b++)this.println(a[b].toString());this.println("----")}})();glift.math={abs:function(a){return 0<=a?a:-1*a},max:function(a,b){return a>b?a:b},min:function(a,b){return a>b?b:a},isEven:function(a){return 0==a%2?!0:!1},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}};
(function(){var a={};glift.util.point=function(c,e){var d=glift.util.coordToString(c,e);if(void 0!==a[d])return a[d];var g=new b(c,e);return a[d]=g};glift.util.uncachedPoint=function(a,e){return new b(a,e)};glift.util._cacheHasPoint=function(b,e){return void 0!==a[glift.util.coordToString(b,e)]};var b=function(b,a){this.x=function(){return b};this.y=function(){return a};this.equals=function(d){return b===d.x()&&a===d.y()};this.toSgfCoord=function(){return String.fromCharCode(b+97)+String.fromCharCode(a+
97)}};b.prototype={hash:function(){return this.toString()},toString:function(){return glift.util.coordToString(this.x(),this.y())},value:function(){return this.toString()},log:function(){glift.util.logz(this.toString())}};glift.util.coordToString=function(b,a){return b+","+a};glift.util.pointFromString=function(b){try{var a=b.split(","),d=parseInt(a[0]),g=parseInt(a[1]);return glift.util.point(d,g)}catch(h){throw"Parsing Error! Couldn't parse a point from: "+b;}};glift.util.pointFromHash=function(b){return glift.util.pointFromString(b)}})();
glift.util.regions={getComponents:function(a){var b=glift.enums.boardRegions,c={};a===b.TOP_LEFT?(c[b.TOP]=1,c[b.LEFT]=1):a===b.TOP_RIGHT?(c[b.TOP]=1,c[b.RIGHT]=1):a===b.BOTTOM_LEFT?(c[b.BOTTOM]=1,c[b.LEFT]=1):a===b.BOTTOM_RIGHT&&(c[b.BOTTOM]=1,c[b.RIGHT]=1);return c}};
glift.testUtil={getAllElements:function(a){var b=[];a.forEach(function(a){b.push(a)});return b},assertEmptyPaper:function(a){a=glift.testUtil.getAllElements(a);deepEqual(a.length,0,"Paper should have been emptied")},assertFullDiv:function(a){ok(""!==$("#"+a).text(),"Div should contain contents")},assertEmptyDiv:function(a){deepEqual($("#"+a).text(),"","Div should not contain contents")}};
glift.themes={registered:{},get:function(a){var b=glift.themes.registered;return!(a in b)?glift.util.none:b[a]},has:function(a){return a in glift.themes.registered}};
glift.themes.registered.DEFAULT={board:{bgColor:"#f5be7e",lineColor:"black",lineSize:1,edgeLineSize:1,starPointSize:0.15,textColor:"white"},stones:{hoverOpacity:0.5,EMPTY:{fill:"blue",opacity:0},BLACK:{fill:"black",opacity:1,"stroke-width":1,stroke:"black"},BLACK_HOVER:{fill:"black",opacity:0.5},WHITE:{stroke:"black",fill:"white",opacity:1,"stroke-width":1},WHITE_HOVER:{fill:"white",opacity:0.5}},marks:{XMARK:{}}};
glift.displays={create:function(a){a=glift.displays.processOptions(a);var b=glift.displays.environment.get(a);return glift.displays.raphael.create(b,a.theme).draw()}};
(function(){glift.displays.bboxFromPts=function(b,c){return new a(b,c)};glift.displays.bbox=function(b,c,e){return new a(b,glift.util.point(b.x()+c,b.y()+e))};var a=function(b,a){this.topLeft=function(){return b};this.botRight=function(){return a};this.center=function(){return glift.util.point(glift.math.abs((a.x()-b.x())/2)+b.x(),glift.math.abs((a.y()-b.y())/2)+b.y())};this.width=function(){return a.x()-b.x()};this.height=function(){return a.y()-b.y()};this.top=function(){return b.y()};this.left=
function(){return b.x()};this.bottom=function(){return a.y()};this.right=function(){return a.x()}};a.prototype={draw:function(b,a){b.rect(this.topLeft().x(),this.topLeft().y(),this.width(),this.height()).attr({fill:a,opacity:0.5})},contains:function(b){return b.x()>=this.topLeft().x()&&b.x()<=this.botRight().x()&&b.y()>=this.topLeft().y()&&b.y()<=this.botRight().y()},log:function(){glift.util.logz("TopLeft: "+JSON.stringify(this.topLeft()));glift.util.logz("BotRight: "+JSON.stringify(this.botRight()));
glift.util.logz("Width: "+this.width());glift.util.logz("Height: "+this.height())},equals:function(b){return b.topLeft&&this.topLeft().equals(b.topLeft())&&b.botRight&&this.botRight().equals(b.botRight())}}})();
(function(){glift.displays.boardPoints=function(){return new a};glift.displays.boardPointsFromLineBox=function(b){for(var a=b.spacing,e=b.bbox,d=e.left()+b.extensionBox.left()*a,e=e.top()+b.extensionBox.top()*a,g=b.pointTopLeft.x(),h=b.pointTopLeft.y(),k=glift.displays.boardPoints(),l=0;l<=b.yPoints;l++)for(var m=0;m<=b.xPoints;m++){var p=d+m*a,q=e+l*a,v=glift.util.point(g+m,h+l),p=glift.util.point(p,q);k.add(v,p)}k.setSpacing(a);return k};var a=function(){this.points={};this.spacing=void 0};a.prototype=
{add:function(b,a){void 0===this.points[b.hash()]&&(this.points[b.hash()]=a);return this},setSpacing:function(b){this.spacing=b;return this},getCoords:function(){return this.points},hasCoord:function(b){return void 0!==this.points[b.hash()]},getCoord:function(b){return this.points[b.hash()]},_debugDraw:function(b,a){for(var e in this.points){var d=this.points[e];b.circle(d.x(),d.y(),this.spacing/2).attr({fill:a,opacity:0.3})}}}})();
(function(){glift.displays.cropbox={LINE_EXTENSION:0.5,DEFAULT_EXTENSION:0,OVERFLOW:1.5,create:function(b,c,e,d){return new a(b,c,e,d)},getFromRegion:function(b,a){var e=glift.util,d=glift.enums.boardRegions;b=b||d.ALL;var g=a-1,h=Math.ceil(g/2),k=0,l=0,m=g,p=g,q=this.DEFAULT_EXTENSION,v=this.DEFAULT_EXTENSION,w=this.DEFAULT_EXTENSION,y=this.DEFAULT_EXTENSION;switch(b){case d.LEFT:p=h+1;y=this.LINE_EXTENSION;break;case d.RIGHT:l=h-1;v=this.LINE_EXTENSION;break;case d.TOP:m=h+1;w=this.LINE_EXTENSION;
break;case d.BOTTOM:k=h-1;q=this.LINE_EXTENSION;break;case d.TOP_LEFT:m=h+1;w=this.LINE_EXTENSION;p=h+2;y=this.LINE_EXTENSION;break;case d.TOP_RIGHT:m=h+1;w=this.LINE_EXTENSION;l=h-2;v=this.LINE_EXTENSION;break;case d.BOTTOM_LEFT:k=h-1;q=this.LINE_EXTENSION;p=h+2;y=this.LINE_EXTENSION;break;case d.BOTTOM_RIGHT:k=h-1,q=this.LINE_EXTENSION,l=h-2,y=this.LINE_EXTENSION}d=glift.displays.bboxFromPts(e.point(l,k),e.point(p,m));e=glift.displays.bboxFromPts(e.point(v,q),e.point(y,w));return glift.displays.cropbox.create(d,
e,0,g)}};var a=function(b,a,e,d){var g=glift.displays.cropbox.OVERFLOW;this.cbox=function(){return b};this.extBox=function(){return a};this.xPoints=function(){return b.width()};this.yPoints=function(){return b.height()};this.widthMod=function(){return b.width()+a.topLeft().x()+a.botRight().x()+g};this.heightMod=function(){return b.height()+a.topLeft().y()+a.botRight().y()+g}}})();
(function(){var a=glift.util;glift.displays.environment={TOPBAR_SIZE:0.1,BOTTOMBAR_SIZE:0.1,get:function(a){return new b(glift.displays.processOptions(a))},getInitialized:function(b){return glift.displays.environment.get(b).init()},environmentCopy:function(a){return new b(glift.displays.processOptions({divId:a.divId,boardRegion:a.boardRegion,intersections:a.intersections}))}};var b=function(b){this.divId=b.divId;this.boardRegion=b.boardRegion;this.intersections=b.intersections;this.cropbox=b.displayConfig._cropbox||
glift.displays.cropbox.getFromRegion(this.boardRegion,this.intersections);this.widthOverride=this.heightOverride=!1;void 0!==b.displayConfig._divHeight&&(this.divHeight=b.displayConfig._divHeight,this.heightOverride=!0);void 0!==b.displayConfig._divWidth&&(this.divWidth=b.displayConfig._divWidth,this.widthOverride=!0)};b.prototype={init:function(){(!this.heightOverride||!this.widthOverride)&&this._resetDimensions();var b=this.divHeight,e=this.divWidth,d=this.cropbox,b=glift.displays.bboxFromPts(a.point(0,
0),a.point(e,b)),e=glift.displays.getResizedBox(b,d),d=glift.displays.getLineBox(e,d),g=glift.displays.boardPointsFromLineBox(d),h=glift.displays.getLineSegments(d);this.divBox=b;this.goBoardBox=this.resizedBox=e;this.goBoardLineBox=d;this.boardPoints=g;this.lineSegments=h;return this},setIntersections:function(b){this.intersections=b},_resetDimensions:function(){this.divHeight=$("#"+this.divId).height();this.divWidth=$("#"+this.divId).width();this.needsInitialization=!0;return this},_debugDrawAll:function(){var b=
Raphael(this.divId,"100%","100%");this.divBox.draw(b,"yellow");this.resizedBox.draw(b,"red");this.goBoardBox.draw(b,"orange");this.goBoardLineBox.bbox.draw(b,"red");this.goBoardLineBox._debugDrawLines(b,"blue");this.boardPoints._debugDraw(b,"green");this.lineSegments._debugDraw(b,"black")}}})();
(function(){glift.displays.getLineBox=function(b,c){var e=glift.displays.cropbox.OVERFLOW,d=b.width()/c.widthMod(),g=b.height()/c.heightMod(),h=g*e/2,k=d*e/2,l=g*(c.heightMod()-e/2),e=d*(c.widthMod()-e/2),m=b.topLeft().x(),p=b.topLeft().y(),h=glift.displays.bboxFromPts(glift.util.point(k+m,h+p),glift.util.point(e+m,l+p));return new a(h,d,g,c)};var a=function(b,a,e,d){this.bbox=b;this._xSpacing=a;this._ySpacing=e;this.spacing=a;this.extensionBox=d.extBox();this.pointTopLeft=d.cbox().topLeft();this.xPoints=
d.xPoints();this.yPoints=d.yPoints()};a.prototype={_debugDrawLines:function(b,a){for(var e=this.bbox.left(),d=this.bbox.top();e<=this.bbox.right();e+=this.spacing,d+=this.spacing)b.rect(e,d,this.spacing,this.spacing).attr({fill:a,opacity:0.5})}}})();
(function(){glift.displays.getLineSegments=function(c){for(var e=new a,d=glift.util.point,g=c.spacing,h=c.bbox.left()+c.extensionBox.left()*g,k=c.bbox.top(),l=c.bbox.bottom(),m=0;m<=c.xPoints;m++){var p=h+m*g,q=c.pointTopLeft.x()+m;e.vert.push(new b(d(p,k),d(p,l),q))}h=c.bbox.left();l=c.bbox.right();k=c.bbox.top()+c.extensionBox.top()*g;for(m=0;m<=c.yPoints;m++)p=k+m*g,q=c.pointTopLeft.y()+m,e.horz.push(new b(d(h,p),d(l,p),q));return e};var a=function(){this.horz=[];this.vert=[]};a.prototype._debugDraw=
function(b,a){for(var d=glift.displays.raphael.rutil,g=[this.horz,this.vert],h=0;h<g.length;h++)for(var k=g[h],l=0;l<k.length;l++)b.path(d.svgMovePt(k[l].topLeft)+d.svgLineAbsPt(k[l].botRight))};var b=function(b,a,d){this.topLeft=b;this.botRight=a;this.ordinal=d}})();
glift.displays.processOptions=function(a){var b=function(b){this.name="DisplayOptionError";this.message=b};b.prototype=Error();var c={intersections:19,divId:"glift_display",theme:"DEFAULT",boardRegion:"ALL",displayConfig:{}},e;for(e in a){var d=a[e];switch(e){case "intersections":if("number"==glift.util.typeOf(d)&&0<d)c.intersections=d;else throw new b("Intersection value : "+e);break;case "theme":if(glift.themes.has(d))c.theme=d;else throw new b("Unknown theme: "+d);break;case "divId":if(null!==
document.getElementById(d))c.divId=d;else throw new b("Could not find div with id: "+d);break;case "boardRegion":if(void 0!==glift.enums.boardRegions[d])c.boardRegion=d;else throw new b("Unknown board region: "+d);break;case "displayConfig":if("object"===glift.util.typeOf(d))c.displayConfig=d;else throw new b("displayConfig not an object: "+d);break;default:glift.util.logz("Unknown option key: "+e)}}return c};
glift.displays.getResizedBox=function(a,b){var c=glift.util,e=glift.displays.getCropDimensions(a.width(),a.height(),b),d=e.width(),g=e.height(),h=a.width()-d,k=a.height()-g,l=0===h?0:h/2,m=0===k?0:k/2,p=a.topLeft().x()+l,q=a.topLeft().y()+m,c=glift.displays.bbox(c.point(p,q),d,g);glift.global.debugMode&&(c._debugInfo=function(){return{newDims:e,newWidth:d,newHeight:g,xDiff:h,yDiff:k,xDelta:l,yDelta:m,newLeft:p,newTop:q}});return c};
glift.displays.getCropDimensions=function(a,b,c){var e=b/a;c=c.heightMod()/c.widthMod();var d=b,g=a;e>c?d=a*c:e<c&&(g=b/c);return{height:function(){return d},width:function(){return g}}};
(function(){glift.displays.raphael={create:function(b,a){return new glift.displays.raphael.Display(b,a)}};glift.displays.raphael.Display=function(b,a){this._objectHistory=[];this._paper=glift.util.none;this._environment=b;this._themeName=a;this._theme=glift.themes.get(a);this._stones=glift.util.none;this.intersections=function(){return this._environment.intersections};this.divId=function(){return this._environment.divId};this.theme=function(){return this._themeName};this.boardRegion=function(){return this._environment.boardRegion}};
var a=glift.displays.raphael.Display;a.prototype.init=function(){this._paper=Raphael(this.divId(),"100%","100%");this._environment.init();return this};a.prototype.draw=function(){this.init();for(var b=0;b<this._objectHistory.length;b++)this._objectHistory[b].destroy();this._objectHistory=[this.createBoardBase(),this.createBoardLines(),this.createStarPoints()];this._stones=this.createStones();this._objectHistory.push(this._stones);return this};a.prototype.destroy=function(){for(var b=0;b<this._objectHistory.length;b++)this._objectHistory[b].destroy();
this._objectHistory=[];this._paper.remove();this._stones=this._paper=glift.util.none;$("#"+this.divId()).empty()};a.prototype.recreate=function(b){this.destroy();b=glift.displays.processOptions(b);this._environment=glift.displays.environment.get(b);this._themeName=b.theme;this._theme=glift.themes.get(b.theme);return this};a.prototype.enableAutoResizing=function(){var b=this,a=function(){b.redraw()},e;$(window).resize(function(b){clearTimeout(e);e=setTimeout(a,200)})};a.prototype.redraw=function(){this._environment.init();
for(var b=0;b<this._objectHistory.length;b++)this._objectHistory[b].redraw()};a.prototype.setColor=function(b,a){if(this._stones!==glift.util.none)return this._stones.setColor(b,a),this;throw"Stones === none! Cannot setColor";};a.prototype.setClickHandler=function(b){this._stones.setClickHandler(b)};a.prototype.setHoverInHandler=function(b){this._stones.setHoverInHandler(b)};a.prototype.setHoverOutHandler=function(b){this._stones.setHoverOutHandler(b)}})();
(function(){glift.displays.raphael.Display.prototype.createBoardBase=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(b,a,e){this.paper=b;this.environment=a;this.subtheme=e;this.rect=glift.util.none};a.prototype={draw:function(){var b=this.environment.goBoardBox;this.destroy();this.rect=this.paper.rect(b.topLeft().x(),b.topLeft().y(),b.width(),b.height());this.rect.attr({fill:this.subtheme.bgColor});return this},redraw:function(){return this.draw()},
destroy:function(){this.rect&&this.rect!==glift.util.none&&this.rect.remove();return this}}})();
(function(){glift.displays.raphael.Display.prototype.createBoardLines=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(b,a,d){this.paper=b;this.environment=a;this.subtheme=d;this.vertSet=this.horzSet=glift.util.none};a.prototype={draw:function(){this.destroy();var a=this.paper,e=this.subtheme,d=this.environment.lineSegments,g=this.environment.intersections;this.horzSet=b(a,d.horz,g,e.lineSize,e.edgeLineSize);this.vertSet=b(a,d.vert,g,e.lineSize,e.edgeLineSize);
return this},redraw:function(){return this.draw()},destroy:function(){this.horzSet&&this.horzSet!==glift.util.none&&this.horzSet.remove();this.vertSet&&this.vertSet!==glift.util.none&&this.vertSet.remove();return this}};var b=function(b,a,d,g,h){for(var k=b.set(),l=glift.displays.raphael.rutil,m=0;m<a.length;m++){var p=b.path(l.svgMovePt(a[m].topLeft)+l.svgLineAbsPt(a[m].botRight)),q=a[m].ordinal;p.attr({"stroke-linecap":"round","stroke-width":0===q||q===d-1?h:g});k.push(p)}return k}})();
(function(){glift.displays.raphael.Display.prototype.createMarks=function(){return new a(this._paper,this._environment,this._theme.marks)};var a=function(b,a,e){this.paper=b;this.environment=a;this.subtheme=e;this.marks={}};a.prototype={addMark:function(b,a,e){switch(b){case "XMARK":_addXMark(a,e)}return this},_addXMark:function(b,a){b.hash()},clearMark:function(b){},clearMarks:function(){}}})();
glift.displays.raphael.rutil={svgMove:function(a,b){return"M"+a+","+b},svgMovePt:function(a){return glift.displays.raphael.rutil.svgMove(a.x(),a.y())},svgLineRel:function(a,b){return"l"+a+","+b},svgLineRelPt:function(a){return glift.displays.raphael.rutil.svgLineRel(a.x(),a.y())},svgLineAbs:function(a,b){return"L"+a+","+b},svgLineAbsPt:function(a){return glift.displays.raphael.rutil.svgLineAbs(a.x(),a.y())},transform:function(a){return"t"+a.xMove+","+a.yMove+"s"+a.xScale+","+a.yScale}};
(function(){glift.displays.raphael.Display.prototype.createStarPoints=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(b,a,e){this.paper=b;this.environment=a;this.subtheme=e;this.starSet=glift.util.none};a.prototype={draw:function(){this.destroy();for(var b=glift.util.point,a=this.environment.boardPoints,e=a.spacing*this.subtheme.starPointSize,d={9:[[2,6],[4]],13:[[3,9],[6]],19:[[3,9,15]]}[this.environment.intersections]||[],g=this.paper.set(),h=0;h<
d.length;h++)for(var k=d[h],l=0;l<k.length;l++)for(var m=0;m<k.length;m++){var p=b(k[l],k[m]);a.hasCoord(p)&&(p=a.getCoord(p),g.push(this.paper.circle(p.x(),p.y(),e)))}g.attr({fill:this.subtheme.lineColor});this.starSet=g;return this},redraw:function(){return this.draw()},destroy:function(){this.starSet&&this.starSet!==glift.util.none&&this.starSet.remove();return this}}})();
(function(){glift.displays.raphael.createStone=function(b,c,e,d,g){return new a(b,c,e,d,g)};var a=function(b,a,e,d,g){this.paper=b;this.intersection=a;this.coordinate=e;this.subtheme=g;this.radius=d/2-0.2;this.bbox=this.circle=this.colorState=glift.util.none;this.bboxHoverIn=function(){throw"bboxHoverIn not Defined";};this.bboxHoverOut=function(){throw"bboxHoverOut not defined";};this.bboxClick=function(){throw"bboxClick not defined";};this.clickHandler=function(b){};this.hoverInHandler=function(b){};
this.hoverOutHandler=function(b){}};a.prototype={draw:function(){this.destroy();var b=this.paper,a=this.radius,e=this.coordinate,d=this.intersection,g=this;this.circle=b.circle(e.x(),e.y(),a);this.bbox=b.rect(e.x()-a,e.y()-a,2*a,2*a);this.bbox.attr({fill:"white",opacity:0});this.bboxHoverIn=function(){g.hoverInHandler(d)};this.bboxHoverOut=function(){g.hoverOutHandler(d)};this.bboxClick=function(){g.clickHandler(d)};this.bbox.hover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.click(this.bboxClick);
this.setColor("EMPTY");return this},cloneHandlers:function(b){for(var a="bboxHoverIn bboxHoverOut bboxClick clickHandler hoverInHandler hoverOutHandler".split(" "),e=0;e<a.length;e++)b[a[e]]&&(this[a[e]]=b[a[e]])},setColor:function(b){if(this.circle===glift.util.none)throw"Circle was not initialized, so cannot set color";b in this.subtheme||glift.util.logz("Key "+b+" not found in theme");this.circle.attr(this.subtheme[b]);this.colorState=b},redraw:function(){return this.draw()},destroy:function(){if(this.circle===
glift.util.none||this.bbox===glift.util.none)return this;this.bbox.unhover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.unclick(this.bboxClick);this.bbox.remove();this.circle.remove();return this},_bboxToFront:function(){this.bbox&&this.bbox!==glift.util.non&&this.bbox.toFront();return this},addMark:function(b,a){}}})();
(function(){glift.displays.raphael.Display.prototype.createStones=function(){return(new a(this._paper,this._environment,this._theme.stones)).draw()};var a=function(a,c,e){this.paper=a;this.environment=c;this.subtheme=e;this.stoneMap=glift.util.none};a.prototype={draw:function(){var a={},c=this.environment.boardPoints,e;for(e in c.points){var d=c.points[e],g=glift.util.pointFromHash(e),d=glift.displays.raphael.createStone(this.paper,g,d,c.spacing,this.subtheme);if(this.stoneMap&&this.stoneMap!==glift.util.none&&
this.stoneMap[e]){var g=this.stoneMap[e],h=g.colorState;d.cloneHandlers(g);d.draw();d.setColor(h);this.stoneMap[e].destroy()}else d.draw();a[e]=d}this.stoneMap=a;return this},redraw:function(){return this.draw()},setClickHandler:function(a){return this._handler("clickHandler",a)},setHoverInHandler:function(a){return this._handler("hoverInHandler",a)},setHoverOutHandler:function(a){return this._handler("hoverOutHandler",a)},_handler:function(a,c){for(var e in this.stoneMap)this.stoneMap[e][a]=c;return this},
forceClick:function(a){this.stoneMap[a.hash()].bboxClick()},forceHoverIn:function(a){this.stoneMap[a.hash()].bboxHoverIn()},forceHoverOut:function(a){this.stoneMap[a.hash()].bboxHoverOut()},setColor:function(a,c){var e=this.stoneMap[a.hash()];if(void 0===e)throw"Could not find stone for point: "+a.toString();e.setColor(c);return this},destroy:function(){for(var a in this.stoneMap)this.stoneMap[a].destroy();this.stoneMap={}}}})();glift.rules={};
(function(){var a=glift.util;glift.rules.goban={getInstance:function(a){return new b(a||19)},getFromMoveTree:function(a,e){var c=new b(a.getIntersections()),k=a.getTreeFromRoot();void 0===e&&(e=[]);c.loadStonesFromMovetree(k);for(var l=0;l<e.length;l++)k.moveDown(e[l]),c.loadStonesFromMovetree(k);return c}};var b=function(a){if(0>=a)throw"Intersections must be greater than 0";this.ints=a;for(var b=[],e=0;e<a;e++){for(var c=[],l=0;l<a;l++)c[l]=glift.enums.states.EMPTY;b[e]=c}this.stones=b};b.prototype=
{intersections:function(){return this.ints},getStone:function(a){return this.stones[a.y()][a.x()]},getAllPlacedStones:function(){for(var b=[],e=0;e<this.stones.length;e++)for(var c=this.stones[e],k=0;k<c.length;k++){var l=a.point(k,e),m=this.getStone(l);(m===glift.enums.states.BLACK||m===glift.enums.states.WHITE)&&b.push({point:l,color:m})}return b},placeable:function(a,b){return this.inBounds(a)&&this.getStone(a)===glift.enums.states.EMPTY},outBounds:function(b){return a.outBounds(b.x(),this.ints)||
a.outBounds(b.y(),this.ints)},inBounds:function(b){return a.inBounds(b.x(),this.ints)&&a.inBounds(b.y(),this.ints)},clearStone:function(a){this._setColor(a,glift.enums.states.EMPTY)},clearSome:function(a){for(var b=1;b<a.length;b++)this.clearStone(a[b])},_setColor:function(a,b){this.stones[a.y()][a.x()]=b},addStone:function(b,g){if(!a.colors.isLegalColor(g))throw"Unknown color: "+g;if(this.outBounds(b)||!this.placeable(b))return new e(!1);this._setColor(b,g);var h=new c,k=a.colors.oppositeColor(g);
this._getCaptures(h,a.point(b.x()+1,b.y()),k);this._getCaptures(h,a.point(b.x()-1,b.y()),k);this._getCaptures(h,a.point(b.x(),b.y()-1),k);this._getCaptures(h,a.point(b.x(),b.y()+1),k);if(0>=h.numCaptures&&(this._getCaptures(h,b,g),0<h.numCaptures))return this.clearStone(b),new e(!1);h=h.getCaptures();this.clearSome(h);return new e(!0,h)},_getCaptures:function(a,b,e){this._findConnected(a,b,e);0>=a.liberties&&a.consideringToCaptures();a.clearExceptCaptures()},_findConnected:function(b,e,c){if(!(void 0!==
b.seen[e.hash()]||this.outBounds(e))){b.seen[e.hash()]=!0;var k=this.getStone(e);if(k===glift.enums.states.EMPTY)b.liberties++;else if(k!==a.colors.oppositeColor(c))if(k===c)b.considering.push(e),this._findConnected(b,a.point(e.x()+1,e.y()),c),this._findConnected(b,a.point(e.x()-1,e.y()),c),this._findConnected(b,a.point(e.x(),e.y()+1),c),this._findConnected(b,a.point(e.x(),e.y()-1),c);else throw"Unknown color error: "+k;}},loadStonesFromMovetree:function(b){for(var e=[glift.enums.states.BLACK,glift.enums.states.WHITE],
c=0;c<e.length;c++)for(var k=b.getProperties().getPlacementsAsPoints(e[c]),l=0;l<k.length;l++)(this.placeable(k[l]),e[c])&&this.addStone(k[l],e[c]);b=b.getProperties().getMove();b!=a.none&&this.addStone(b.point,b.color)},_debug:function(){glift.util.logz(this.stones)}};var c=function(){this.toCapture={};this.numCaptures=0;this.considering=[];this.seen={};this.liberties=0};c.prototype={clearExceptCaptures:function(){this.considering=[];this.seen={};this.liberties=0},consideringToCaptures:function(){for(var a=
0;a<this.considering.length;a++){var b=this.considering[a];void 0===this.toCapture[b.hash()]&&(this.toCapture[b.hash()]=!0,this.numCaptures++)}},addLiberties:function(a){this.liberties+=a},addSeen:function(a){this.seen[a.hash()]=!0},getCaptures:function(){var b=[],e;for(e in this.toCapture)b.push(a.pointFromHash(e));return b}};var e=function(a,b){this.captures=(this.successful=a)?b:[]}})();
(function(){var a=glift.enums;glift.rules.intersections={propertiesToMarks:{CR:a.marks.CIRCLE,LB:a.marks.LETTER,MA:a.marks.XMARK,SQ:a.marks.SQUARE,TR:a.marks.TRIANGLE},getFullBoardData:function(b,c){for(var e={},d={},g=c.getAllPlacedStones(),h=0;h<g.length;h++){var k=g[h].point,l={};l.point=k;l[a.marks.STONE]=g[h].color;d[k.hash()]=l}d=this.addCurrentMarks(d,b);e.points=d;b.getProperties().getComment()!==glift.util.none&&(e.comment=b.getProperties().getComment());return e},getChangeData:function(a,
c,e){},addCurrentMarks:function(a,c){for(var e in glift.rules.intersections.propertiesToMarks){var d=glift.rules.intersections.propertiesToMarks[e];if(c.getProperties().contains(e))for(var g=c.getProperties().get(e),h=0;h<g.length;h++){var k={},l=!0;e===glift.sgf.allProperties.LB?(l=glift.sgf.convertFromLabelData(g[h]),k=l.point,l=l.value):k=glift.sgf.sgfCoordToPoint(g[h]);var m=k.hash();void 0===a[m]&&(a[m]={point:k});a[m][d]=l}}return a}}})();
(function(){glift.rules.movenode=function(b,e){return new a(b,e)};var a=function(a,b){this.properties=a||glift.rules.properties();this.children=b||[];this.nodeId={nodeNum:0,varNum:0}};a.prototype={setNodeId:function(a,b){this.nodeId={nodeNum:a,varNum:b};return this},getNodeNum:function(){return this.nodeId.nodeNum},getVarNum:function(){return this.nodeId.varNum},numChildren:function(){return this.children.length},addChild:function(){this.children.push(glift.rules.movenode().setNodeId(this.getNodeNum()+
1,this.numChildren()));return this},getNext:function(a){return void 0===a?this.children[0]:this.children[a]},renumber:function(){b(this,this.nodeId.nodeNum,this.nodeId.varNum);return this}};var b=function(a,e,d){a.setNodeId(e,d);for(d=0;d<a.children.length;d++)b(a.children[d],e+1,d);return a}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.movetree={getInstance:function(a){a=a||19;var b=new c(glift.rules.movenode());b.setIntersections(a);return b},getFromSgf:function(a,b){void 0===b&&(b=[]);if(void 0===a||""===a)return glift.rules.movetree.getInstance(19);for(var g=new c(glift.sgf.parser.parse($.trim(a))),h=0;h<b.length;h++)g.moveDown(b[h]);return g},getFromNode:function(a){return new c(a)},searchMoveTreeDFS:function(a,b){b(a);for(var c=0;c<a.getNode().numChildren();c++)glift.rules.movetree.searchMoveTreeDFS(a.moveDown(c),
b);a.moveUp()}};var c=function(a){this._nodeHistory=[];this._nodeHistory.push(a)};c.prototype={getTreeFromRoot:function(){return glift.rules.movetree.getFromNode(this._nodeHistory[0])},getNode:function(){return this._nodeHistory[this._nodeHistory.length-1]},getProperties:function(){return this.getNode().properties},findNextMove:function(b,d){for(var c=this.getNode().children,h=glift.sgf.colorToToken(d),k={},l=0;l<c.length;l++){var m=c[l];m.properties.contains(h)&&(k[m.properties.getAsPoint(h).hash()]=
m.getVarNum())}return void 0!==k[b.hash()]?k[b.hash()]:a.none},getCurrentPlayer:function(){var e=this.getProperties().getMove();return e===a.none?b.states.BLACK:e.color===b.states.BLACK?b.states.WHITE:b.states.BLACK},moveDown:function(a){a=void 0===a?0:a;void 0!==this.getNode().getNext(a)&&(a=this.getNode().getNext(a),this._nodeHistory.push(a));return this},moveUp:function(){1<this._nodeHistory.length&&this._nodeHistory.pop();return this},moveToRoot:function(){this._nodeHistory=this._nodeHistory.slice(0,
1);return this},addNewNode:function(){this.getNode().addChild();this.moveDown(this.getNode().numChildren()-1);return this},deleteCurrentNode:function(){glift.rules.movetree.getNodeId();VarNum=this.getVarNum();this.moveUp();this.getAllNextNodes();return this},recurse:function(a){glift.rules.movetree.searchMoveTreeDFS(this,a)},recurseFromRoot:function(a){glift.rules.movetree.searchMoveTreeDFS(this.getTreeFromRoot(),a)},toSgf:function(){for(var a in this.getAllProps());},debugLog:function(a){void 0===
a&&(a="  ");glift.util.logz(a+this.getNode(b).getVarNum()+"-"+this.getNode(b).getNodeNum());for(var b=0;b<this.getNode().numChildren();b++)this.moveDown(b),this.debugLog(a),this.moveUp()},setIntersections:function(a){var b=this.getTreeFromRoot(),c=glift.sgf.allProperties;b.getProperties().contains(c.SZ)||this.getProperties().add(c.SZ,a+"");return this},getIntersections:function(){var a=this.getTreeFromRoot(),b=glift.sgf.allProperties;if(a.getNode().properties.contains(b.SZ))return parseInt(a.getNode().properties.get(b.SZ))},
isCorrectPosition:function(){var a=glift.enums.problemResults;if(this.getProperties().isCorrect())return a.CORRECT;for(var b=glift.rules.treepath.flattenMoveTree(this),c={},h=0;h<b.length;h++){for(var k=b[h],l=glift.rules.movetree.getFromNode(this.getNode()),m=!1,p=0;p<k.length;p++)l.moveDown(k[p]),l.getProperties().isCorrect()&&(m=!0);m?c[a.CORRECT]=!0:c[a.INCORRECT]=!0}return c[a.CORRECT]&&!c[a.INCORRECT]?a.CORRECT:c[a.CORRECT]&&c[a.INCORRECT]?a.INDETERMINATE:a.INCORRECT}}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.properties=function(a){return new c(a)};var c=function(a){this.propMap=void 0===a?{}:a};c.prototype={add:function(b,c){if(void 0===glift.sgf.allProperties[b])throw"Can't add undefined properties";"string"!==a.typeOf(c)&&"array"!==a.typeOf(c)&&(c=c.toString());c="string"===a.typeOf(c)?[c]:c;this.contains(b)?this.propMap[b]=this.get(b).concat(c):this.propMap[b]=c;return this},get:function(b){if(void 0===glift.sgf.allProperties[b])return a.debugl("attempted to retrieve a property that is not part of the SGF Spec: "+
b),a.none;if(void 0!==this.propMap[b])return this.propMap[b];a.debugl("no property: "+b+" exists for the current move");return a.none},getDatum:function(b,c){c=void 0!==c&&"number"===typeof c&&0<=c?c:0;var g=this.get(b);return g!==a.none&&1<=g.length?g[c]:a.none},getAsPoint:function(b,c){var g=this.getDatum(b,c);return g!==a.none?glift.sgf.sgfCoordToPoint(g):g},contains:function(b){return this.get(b)!==a.none},remove:function(b){if(this.contains(b)){var c=this.get(b);delete this.propMap[b];return c}return a.none},
replace:function(a,b){this.propMap[a]=b},getPlacementsAsPoints:function(a){var c="";a===b.states.BLACK?c=glift.sgf.allProperties.AB:a===b.states.WHITE&&(c=glift.sgf.allProperties.AW);return""===c||!this.contains(c)?[]:glift.sgf.allSgfCoordsToPoints(this.get(c))},getComment:function(){return this.contains("C")?this.getDatum("C"):a.none},getMove:function(){return this.contains("B")?{color:b.states.BLACK,point:glift.sgf.sgfCoordToPoint(this.getDatum("B"))}:this.contains("W")?{color:b.states.WHITE,point:glift.sgf.sgfCoordToPoint(this.getDatum("W"))}:
a.none},isCorrect:function(){return this.contains("GB")?!0:!1},getAllStones:function(){var b=glift.enums.states,c={},g=b.WHITE;c[b.BLACK]=this.getPlacementsAsPoints(b.BLACK);c[g]=this.getPlacementsAsPoints(b.WHITE);b=this.getMove();b!=a.none&&c[b.color].push(b.point);return c}}})();
glift.rules.treepath={parseInitPosition:function(a){if(void 0===a)return[];if("number"===glift.util.typeOf(a))a=""+a;else{if("array"===glift.util.typeOf(a))return a;if("string"!==glift.util.typeOf(a))return[]}var b=[],c=0;a=a.split("-");for(var e=0;e<a.length;e++){for(var d=a[e].split("."),g=0;g<d[0]-c;g++)b.push(0);c=d[0];for(g=1;g<d.length;g++)b.push(parseInt(d[g])),c++}return b},flattenMoveTree:function(a){for(var b=[],c=0;c<a.getNode().numChildren();c++){a.moveDown(c);var e=glift.rules.treepath._flattenMoveTree(a,
[]);a.moveUp();for(var d=0;d<e.length;d++)b.push(e[d])}return b},_flattenMoveTree:function(a,b){void 0===b&&(b=[]);b.push(a.getNode().getVarNum());for(var c=[],e=0;e<a.getNode().numChildren();e++){a.moveDown(e);var d=glift.rules.treepath._flattenMoveTree(a,b.slice()),c=c.concat(d);a.moveUp(e)}0==c.length&&c.push(b);return c}};
glift.sgf={colorToToken:function(a){if(a===glift.enums.states.WHITE)return"W";if(a===glift.enums.states.BLACK)return"B";throw"Unknown color-to-token conversion for: "+a;},sgfCoordToPoint:function(a){return glift.util.point(a.charCodeAt(0)-97,a.charCodeAt(1)-97)},allSgfCoordsToPoints:function(a){for(var b=[],c=0;c<a.length;c++)b.push(glift.sgf.sgfCoordToPoint(a[c]));return b},convertFromLabelData:function(a){a=a.split(":");return{point:glift.sgf.sgfCoordToPoint(a[0]),value:a[1]}},convertFromLabelArray:function(a){for(var b=
[],c=0;c<a.length;c++)b.push(glift.sgf.convertFromLabelData(a[c]));return b},pointToSgfCoord:function(a){return String.fromCharCode(a.x()+97)+String.fromCharCode(a.y()+97)}};
glift.sgf.allProperties={AB:"AB",AE:"AE",AN:"AN",AP:"AP",AR:"AR",AS:"AS",AW:"AW",B:"B",BL:"BL",BM:"BM",BR:"BR",BS:"BS",BT:"BT",C:"C",CA:"CA",CH:"CH",CP:"CP",CR:"CR",DD:"DD",DM:"DM",DO:"DO",DT:"DT",EL:"EL",EV:"EV",EX:"EX",FF:"FF",FG:"FG",GB:"GB",GC:"GC",GM:"GM",GN:"GN",GW:"GW",HA:"HA",HO:"HO",ID:"ID",IP:"IP",IT:"IT",IY:"IY",KM:"KM",KO:"KO",L:"L",LB:"LB",LN:"LN",LT:"LT",M:"M",MA:"MA",MN:"MN",N:"N",OB:"OB",OM:"OM",ON:"ON",OP:"OP",OT:"OT",OV:"OV",OW:"OW",PB:"PB",PC:"PC",PL:"PL",PM:"PM",PW:"PW",RE:"RE",
RG:"RG",RO:"RO",RU:"RU",SC:"SC",SE:"SE",SI:"SI",SL:"SL",SO:"SO",SQ:"SQ",ST:"ST",SU:"SU",SZ:"SZ",TB:"TB",TC:"TC",TE:"TE",TM:"TM",TR:"TR",TW:"TW",UC:"UC",US:"US",V:"V",VW:"VW",W:"W",WL:"WL",WR:"WR",WS:"WS",WT:"WT"};
glift.sgf.parser=function(){var a={parse:function(a,c){function e(a){var b=a.charCodeAt(0);if(255>=b){a="x";var c=2}else a="u",c=4;a="\\"+a;for(var e=b.toString(16).toUpperCase(),b=e,c=c-e.length,e=0;e<c;e++)b="0"+b;return a+b}function d(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,e)+'"'}function g(a){f<x||(f>x&&(x=f,z=[]),z.push(a))}function h(){var c="Variations@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var s=e=f;
if("("===a.substr(f,1)){var d="(";f+=1}else d=null,r&&g('"("');if(null!==d){var h=l();if(null!==h){if(")"===a.substr(f,1)){var m=")";f+=1}else m=null,r&&g('")"');if(null!==m){var p=y(),p=null!==p?p:"";if(null!==p){if("("===a.substr(f,1)){var q="(";f+=1}else q=null,r&&g('"("');if(null!==q){var v=l();if(null!==v){if(")"===a.substr(f,1)){var w=")";f+=1}else w=null,r&&g('")"');if(null!==w){var u=y(),u=null!==u?u:"";if(null!==u){var x=k();null!==x?d=[d,h,m,p,q,v,w,u,x]:(d=null,f=s)}else d=null,f=s}else d=
null,f=s}else d=null,f=s}else d=null,f=s}else d=null,f=s}else d=null,f=s}else d=null,f=s}else d=null,f=s;s=null!==d?[d[1],d[5]].concat(d[8]):null;null===s&&(s=null,f=e);null!==s?e=s:(e=f,s=l(),s=null!==s?void 0===s?[]:[s]:null,null===s&&(s=null,f=e),e=null!==s?s:null);t[c]={nextPos:f,result:e};return e}function k(){var c="MoreVars@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("("===a.substr(f,1)){var n="(";f+=1}else n=null,r&&g('"("');if(null!==n){var h=l();if(null!==h){if(")"===a.substr(f,
1)){var m=")";f+=1}else m=null,r&&g('")"');if(null!==m){var p=y(),p=null!==p?p:"";if(null!==p){var q=k();null!==q?n=[n,h,m,p,q]:(n=null,f=d)}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d;d=null!==n?[n[1]].concat(n[4]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,r&&g('""')),d=null!==d?[]:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}function l(){var c="Moves@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=
e=f;if(";"===a.substr(f,1)){var n=";";f+=1}else n=null,r&&g('";"');if(null!==n){var k=m();if(null!==k){var l=h();null!==l?n=[n,k,l]:(n=null,f=d)}else n=null,f=d}else n=null,f=d;d=null!==n?glift.rules.movenode(glift.rules.properties(n[1]),n[2]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,r&&g('""')),d=null!==d?void 0:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}function m(){var e="Tokens@"+f,c=t[e];if(c)return f=c.nextPos,
c.result;var d=c=f,n=w();if(null!==n){if("["===a.substr(f,1)){var h="[";f+=1}else h=null,r&&g('"["');if(null!==h){var k=q();if(null!==k){if("]"===a.substr(f,1)){var l="]";f+=1}else l=null,r&&g('"]"');if(null!==l){var m=y(),m=null!==m?m:"";if(null!==m){var u=v();if(null!==u){var x=y(),x=null!==x?x:"";if(null!==x){var z=p();null!==z?n=[n,h,k,l,m,u,x,z]:(n=null,f=d)}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d;null!==n?(d=n[7],d[n[0]]=
[n[2]].concat(n[5])):d=null;null===d&&(d=null,f=c);t[e]={nextPos:f,result:d};return d}function p(){var e="MoreTokens@"+f,c=t[e];if(c)return f=c.nextPos,c.result;c=m();if(null===c){c=f;if(""===a.substr(f,0)){var d="";f+=0}else d=null,r&&g('""');d=null!==d?{}:null;null===d&&(d=null,f=c);c=null!==d?d:null}t[e]={nextPos:f,result:c};return c}function q(){var c="Data@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var e=f,d=[];if("\\]"===a.substr(f,2)){var n="\\]";f+=2}else n=null,r&&g('"\\\\]"');null===n&&
(null!==a.substr(f).match(/^[^\]]/)?(n=a.charAt(f),f++):(n=null,r&&g("[^\\]]")),n=null!==n?n:null);for(;null!==n;)d.push(n),"\\]"===a.substr(f,2)?(n="\\]",f+=2):(n=null,r&&g('"\\\\]"')),null===n&&(null!==a.substr(f).match(/^[^\]]/)?(n=a.charAt(f),f++):(n=null,r&&g("[^\\]]")),n=null!==n?n:null);d=null!==d?d.join(""):null;null===d&&(d=null,f=e);t[c]={nextPos:f,result:d};return d}function v(){var c="MoreData@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("["===a.substr(f,1)){var n="[";f+=1}else n=
null,r&&g('"["');if(null!==n){var h=q();if(null!==h){if("]"===a.substr(f,1)){var k="]";f+=1}else k=null,r&&g('"]"');if(null!==k){var l=y(),l=null!==l?l:"";if(null!==l){var m=v();null!==m?n=[n,h,k,l,m]:(n=null,f=d)}else n=null,f=d}else n=null,f=d}else n=null,f=d}else n=null,f=d;d=null!==n?[n[1]].concat(n[4]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,r&&g('""')),d=null!==d?[]:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}
function w(){var e="TokenName@"+f,c=t[e];if(c)return f=c.nextPos,c.result;var d=c=f;if(null!==a.substr(f).match(/^[a-zA-Z]/)){var h=a.charAt(f);f++}else h=null,r&&g("[a-zA-Z]");if(null!==h){if(null!==a.substr(f).match(/^[a-zA-Z]/)){var k=a.charAt(f);f++}else k=null,r&&g("[a-zA-Z]");null!==k?h=[h,k]:(h=null,f=d)}else h=null,f=d;null!==h?d=h:(null!==a.substr(f).match(/^[a-zA-Z]/)?(d=a.charAt(f),f++):(d=null,r&&g("[a-zA-Z]")),d=null!==d?d:null);d=null!==d?1===d.length?d[0]:d.join("").toUpperCase():null;
null===d&&(d=null,f=c);t[e]={nextPos:f,result:d};return d}function y(){var e="WhiteSpace@"+f,d=t[e];if(d)return f=d.nextPos,d.result;d=[];if(" "===a.substr(f,1)){var c=" ";f+=1}else c=null,r&&g('" "');null===c&&("\n"===a.substr(f,1)?(c="\n",f+=1):(c=null,r&&g('"\\n"')),c=null!==c?c:null);for(;null!==c;)d.push(c)," "===a.substr(f,1)?(c=" ",f+=1):(c=null,r&&g('" "')),null===c&&("\n"===a.substr(f,1)?(c="\n",f+=1):(c=null,r&&g('"\\n"')),c=null!==c?c:null);t[e]={nextPos:f,result:d};return d}function A(){var c;
a:{c=z;c.sort();for(var e=null,g=[],h=0;h<c.length;h++)c[h]!==e&&(g.push(c[h]),e=c[h]);switch(g.length){case 0:c="end of input";break a;case 1:c=g[0];break a;default:c=g.slice(0,g.length-1).join(", ")+" or "+g[g.length-1]}}e=Math.max(f,x);e=e<a.length?d(a.charAt(e)):"end of input";return"Expected "+c+" but "+e+" found."}function B(){for(var c=1,e=1,d=!1,f=0;f<x;f++){var g=a.charAt(f);"\n"===g?(d||c++,e=1,d=!1):"\r"===g|"\u2028"===g||"\u2029"===g?(c++,e=1,d=!0):(e++,d=!1)}return{line:c,column:e}}var u=
{Data:q,MoreData:v,MoreTokens:p,MoreVars:k,Moves:l,Start:function(){var c="Start@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("(;"===a.substr(f,2)){var k="(;";f+=2}else k=null,r&&g('"(;"');if(null!==k){var l=m();if(null!==l){var p=h();if(null!==p){if(")"===a.substr(f,1)){var q=")";f+=1}else q=null,r&&g('")"');null!==q?k=[k,l,p,q]:(k=null,f=d)}else k=null,f=d}else k=null,f=d}else k=null,f=d;d=null!==k?glift.rules.movenode(glift.rules.properties(k[1]),k[2]).renumber():null;null===d&&(d=
null,f=e);t[c]={nextPos:f,result:d};return d},TokenName:w,Tokens:m,Variations:h,WhiteSpace:y};if(void 0!==c){if(void 0===u[c])throw Error("Invalid rule name: "+d(c)+".");}else c="Start";var f=0,r=!0,x=0,z=[],t={},u=u[c]();if(null===u||f!==a.length)throw u=B(),new this.SyntaxError(A(),u.line,u.column);return u},toSource:function(){return this._source},SyntaxError:function(a,c,e){this.name="SyntaxError";this.message=a;this.line=c;this.column=e}};a.SyntaxError.prototype=Error.prototype;return a}();
glift.controllers={controllerMap:{},create:function(a){a=glift.controllers.processOptions(a);if(a.controllerType in glift.controllers.controllerMap)return glift.controllers.controllerMap[a.controllerType](a);throw"No controller found for type: "+a.controllerType;}};
(function(){var a=glift.enums.controllerTypes.BASE;glift.controllers.createBaseController=function(){return new b};glift.controllers.controllerMap[a]=glift.controllers.createBaseController;var b=function(){};b.prototype={addStone:function(){throw"Not Implemented";},initialize:function(a){a=glift.rules;var b=this.sgfString;this.initPosition=a.treepath.parseInitPosition(this.initialPosition);this.movetree=a.movetree.getFromSgf(b,this.initPosition);this.goban=a.goban.getFromMoveTree(this.movetree,this.initPosition);
return this.getEntireBoardState()},getEntireBoardState:function(){return glift.rules.intersections.getFullBoardData(this.movetree,this.goban)},canAddStone:function(a,b){return this.goban.placeable(a,b)},getCurrentPlayer:function(){return this.movetree.getCurrentPlayer()},getIntersections:function(){return this.movetree.getIntersections()}}})();
glift.controllers.processOptions=function(a){var b=function(a){this.name="DisplayOptionError";this.message=a};b.prototype=Error();var c={controllerType:"STATIC_PROBLEM_STUDY",initialPosition:[],sgfString:""},e;for(e in a){var d=a[e];switch(e){case "controllerType":if("string"==glift.util.typeOf(d)&&d in glift.enums.controllerTypes)c.controllerType=d;else throw new b("Unknown controllerType: "+d);break;case "initialPosition":c.initialPosition=glift.rules.parseInitPosition(d);break;case "sgfString":if("string"===
glift.util.typeOf(d))c.sgfString=d;else throw new b("Bad type for sgfString: "+d);break;default:glift.util.logz("Unknown option key: "+e)}}return c};
(function(){var a=glift.util,b=glift.enums.controllerTypes.STATIC_PROBLEM_STUDY;glift.controllers.staticProblemStudy={_create:function(b){var d=glift.util.beget(glift.controllers.createBaseController()),d=a.setMethods(d,c);d.initOptions(b);return d}};glift.controllers.createStaticProblemStudy=function(a){a=glift.controllers.staticProblemStudy._create(a);a.initialize("foo");return a};glift.controllers.controllerMap[b]=glift.controllers.createStaticProblemStudy;var c={initOptions:function(a){this.sgfString=
a.sgfString||"";this.initialPosition=a.initialPosition;return this},addStone:function(b,c){var g=glift.enums.problemResults,h=glift.enums.controllerMessages,k=h.FAILURE,l=h.DONE,m=h.CONTINUE,p=g.CORRECT,q=g.INCORRECT,v=g.INDETERMINATE;if(!this.goban.addStone(b,c).successful)return{message:k,reason:"Cannot add stone"};k=this.movetree.findNextMove(b,c);this.lastPlayed={point:b,color:c};if(k===a.none)return{message:l,result:q};this.movetree.moveDown(k);var k=this.movetree.isCorrectPosition(),w=glift.rules.intersections.getFullBoardData(this.movetree,
this.goban);if(k===p)return{message:l,result:p,data:w};if(k===v)return g=glift.math.getRandomInt(0,this.movetree.getNode().numChildren()-1),this.movetree.moveDown(g),g=this.movetree.getProperties().getMove(),this.goban.addStone(g.point,g.color),w=glift.rules.intersections.getFullBoardData(this.movetree,this.goban),{message:m,result:v,data:w};if(k===g.INCORRECT)return{message:h.DONE,result:q};throw"Unexpected result output: "+k;}}})();
glift.bridge={setDisplayState:function(a,b){var c=glift.enums.marks,e;for(e in a.points){var d=a.points[e];c.STONE in d&&b.setColor(d.point,d[c.STONE])}}};
glift.bridge.getFromMovetree=function(a){var b=glift.displays.bboxFromPts,c=glift.util.point,e=glift.enums.boardRegions,d=a.getIntersections()-1,g=Math.ceil(d/2),h={},k={},l=0;h[e.TOP_LEFT]=b(c(0,0),c(g+1,g+1));h[e.TOP_RIGHT]=b(c(g-1,0),c(d,g+1));h[e.BOTTOM_LEFT]=b(c(0,g-1),c(g+1,d));h[e.BOTTOM_RIGHT]=b(c(g-1,g-1),c(d,d));a.recurseFromRoot(function(a){a=a.getProperties().getAllStones();for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];l+=1;for(var g in h)h[g].contains(e)&&(void 0===k[g]&&
(k[g]=[]),k[g].push(e))}});return glift.bridge._getRegionFromTracker(k,l)};glift.bridge._getRegionFromTracker=function(a,b){var c=[],e;for(e in a){if(a[e].length===b)return e;c.push(e)}if(2!==c.length)return glift.boardRegions.ALL;var c=glift.util.intersection(glift.util.regions.getComponents(c[0]),glift.util.regions.getComponents(c[1])),d;for(d in c)return d;return glift.boardRegions.ALL};
