(function(){var a=window.glift||{};a.createDisplay=function(b){return a.displays.create(b)};a.createController=function(b){return a.controllers.create(b)};window.glift=a})();
glift.util={logz:function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);console.log(""+b);return glift.util.none},beget:function(a){var b=function(){};b.prototype=a;return new b},typeOf:function(a){var b=typeof a;"object"===b&&(a?a instanceof Array&&(b="array"):b="null");return b},isArray:function(a){return a&&"object"===typeof a&&a.constructor===Array},inBounds:function(a,b){return a<b&&0<=a},outBounds:function(a,b){return a>=b||0>a},intersection:function(a,
b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=1);return c},getKeyWithDefault:function(a,b,c){void 0===a[b]&&(a[b]=c);return a[b]},sizeOf:function(a){var b=0,c;for(c in a)b+=1;return b},varDefined:function(a,b){var c=b||"";if(void 0===a)throw"Argument cannot be undefined"+(""!==c?": "+c:c);},defined:function(){for(var a=0;a<arguments.length;a++)if(void 0===arguments[a])return!1;return!0},assertDefined:function(a,b){if(void 0===a)throw b;return glift.util.none},checkArgsDefined:function(a,b){for(var c=
0;c<b;c++)if(void 0===a[c])throw"Argument "+c+" of "+a.length+" must be defined, but is undefined";return glift.util.none},setMethods:function(a,b){for(var c in b)a[c]=b[c].bind(a);return a}};glift.util.debugl=function(a){glift.debugOn&&glift.util.log(a)};glift.util.log=function(a){("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))&&JSON.stringify(a);void 0!==console&&void 0!==console.log&&console.log(a)};
(function(){var a=function(){this.type="none"};a.prototype={toString:function(){return"None"}};glift.util.none=new a})();glift.util.colors={isLegalColor:function(a){return a===glift.enums.states.BLACK||a===glift.enums.states.WHITE||a===glift.enums.states.EMPTY},oppositeColor:function(a){return a===glift.enums.states.BLACK?glift.enums.states.WHITE:a===glift.enums.states.WHITE?glift.enums.states.BLACK:a}};
glift.enums={states:{BLACK:"BLACK",WHITE:"WHITE",EMPTY:"EMPTY"},directions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},boardRegions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT",ALL:"ALL"},marks:{CIRCLE:"CIRCLE",LETTER:"LETTER",SQUARE:"SQUARE",STONE:"STONE",TRIANGLE:"TRIANGLE",XMARK:"XMARK"},problemResults:{CORRECT:"CORRECT",
INCORRECT:"INCORRECT",INDETERMINATE:"INDETERMINATE"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},controllerTypes:{BASE:"CONTROLLER_BASE",STATIC_PROBLEM_STUDY:"STATIC_PROBLEM_STUDY",DYNAMIC_PROBLEM_STUDY:"DYNAMIC_PROBLEM_STUDY",EXLORE_SOLUTIONS:"EXPLORE_SOLUTIONS",EXLORE_GAME:"EXPLORE_GAME"}};(function(){glift.errors={};glift.errors.ParseError=function(a){this.name="ParseError";this.message=a||""};glift.errors.ParseError.prototype=Error()})();
(function(){glift.logger=function(a,b){return new glift.Log(a,b)};glift.Log=function(a,b){this.name="#"+a;this.num=b;this.curMsgs=0};glift.Log.prototype.println=function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);$("<p>"+b+"</p>").appendTo(this.name);this.curMsgs++;this.curMsgs>this.num&&($(this.name).children("p:first").remove(),this.curMsgs-=1)};glift.Log.prototype.printv=function(){for(var a=arguments,b="",b=a[0],c=1;c<a.length;c++)b=b+","+
a[c];this.println(b)};glift.Log.prototype.log=glift.Log.prototype.println;glift.Log.prototype.printArr=function(a){for(var b=0;b<a.length;b++)this.println(a[b].toString());this.println("----")}})();glift.math={abs:function(a){return 0<=a?a:-1*a},max:function(a,b){return a>b?a:b},min:function(a,b){return a>b?b:a},isEven:function(a){return 0==a%2?!0:!1},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}};
(function(){var a={};glift.util.point=function(c,d){var e=glift.util.coordToString(c,d);if(void 0!==a[e])return a[e];var g=new b(c,d);return a[e]=g};glift.util.uncachedPoint=function(a,d){return new b(a,d)};glift.util._cacheHasPoint=function(b,d){return void 0!==a[glift.util.coordToString(b,d)]};var b=function(b,a){this.x=function(){return b};this.y=function(){return a};this.toString=function(){return glift.util.coordToString(b,a)};this.equals=function(e){return b===e.x()&&a===e.y()};this.toSgfCoord=
function(){return String.fromCharCode(b+97)+String.fromCharCode(a+97)}};b.prototype={hash:function(){return this.toString()},value:function(){return this.toString()},log:function(){glift.util.logz(this.toString())}};glift.util.coordToString=function(b,a){return b+","+a};glift.util.pointFromString=function(b){try{var a=b.split(","),e=parseInt(a[0]),g=parseInt(a[1]);return glift.util.point(e,g)}catch(h){throw"Parsing Error! Couldn't parse a point from: "+b;}};glift.util.pointFromHash=function(b){return glift.util.pointFromString(b)}})();
glift.util.regions={getComponents:function(a){var b=glift.enums.boardRegions,c={};a===b.TOP_LEFT?(c[b.TOP]=1,c[b.LEFT]=1):a===b.TOP_RIGHT?(c[b.TOP]=1,c[b.RIGHT]=1):a===b.BOTTOM_LEFT?(c[b.BOTTOM]=1,c[b.LEFT]=1):a===b.BOTTOM_RIGHT&&(c[b.BOTTOM]=1,c[b.RIGHT]=1);return c}};
glift.testUtil={getAllElements:function(a){var b=[];a.forEach(function(a){b.push(a)});return b},assertEmptyPaper:function(a){a=glift.testUtil.getAllElements(a);deepEqual(a.length,0,"Paper should have been emptied")},assertFullDiv:function(a){ok(""!==$("#"+a).text(),"Div should contain contents")},assertEmptyDiv:function(a){deepEqual($("#"+a).text(),"","Div should not contain contents")}};
glift.themes={registered:{},get:function(a){var b=glift.themes.registered;return!(a in b)?glift.util.none:b[a]},has:function(a){return a in glift.themes.registered}};
glift.themes.registered.DEFAULT={board:{bgColor:"#f5be7e",lineColor:"black",lineSize:1,edgeLineSize:1,starPointSize:0.15,textColor:"white"},stones:{hoverOpacity:0.5,EMPTY:{fill:"blue",opacity:0},BLACK:{fill:"black",opacity:1,"stroke-width":1,stroke:"black"},BLACK_HOVER:{fill:"black",opacity:0.5},WHITE:{stroke:"black",fill:"white",opacity:1,"stroke-width":1},WHITE_HOVER:{fill:"white",opacity:0.5}},marks:{XMARK:{}}};
glift.displays={create:function(a){a=glift.displays.processOptions(a);var b=glift.displays.environment.get(a);return glift.displays.raphael.create(b,a.theme).draw()}};
(function(){glift.displays.bboxFromPts=function(b,c){return new a(b,c)};glift.displays.bbox=function(b,c,d){return new a(b,glift.util.point(b.x()+c,b.y()+d))};var a=function(b,a){this.topLeft=function(){return b};this.botRight=function(){return a};this.center=function(){return glift.util.point(glift.math.abs((a.x()-b.x())/2)+b.x(),glift.math.abs((a.y()-b.y())/2)+b.y())};this.width=function(){return a.x()-b.x()};this.height=function(){return a.y()-b.y()};this.top=function(){return b.y()};this.left=
function(){return b.x()};this.bottom=function(){return a.y()};this.right=function(){return a.x()}};a.prototype={draw:function(b,a){b.rect(this.topLeft().x(),this.topLeft().y(),this.width(),this.height()).attr({fill:a,opacity:0.5})},contains:function(b){return b.x()>=this.topLeft().x()&&b.x()<=this.botRight().x()&&b.y()>=this.topLeft().y()&&b.y()<=this.botRight().y()},log:function(){glift.util.logz("TopLeft: "+JSON.stringify(this.topLeft()));glift.util.logz("BotRight: "+JSON.stringify(this.botRight()));
glift.util.logz("Width: "+this.width());glift.util.logz("Height: "+this.height())},equals:function(b){return b.topLeft&&this.topLeft().equals(b.topLeft())&&b.botRight&&this.botRight().equals(b.botRight())}}})();
(function(){glift.displays.boardPoints=function(){return new a};glift.displays.boardPointsFromLineBox=function(b){for(var a=b.spacing,d=b.bbox,e=d.left()+b.extensionBox.left()*a,d=d.top()+b.extensionBox.top()*a,g=b.pointTopLeft.x(),h=b.pointTopLeft.y(),l=glift.displays.boardPoints(),m=0;m<=b.yPoints;m++)for(var n=0;n<=b.xPoints;n++){var p=e+n*a,r=d+m*a,w=glift.util.point(g+n,h+m),p=glift.util.point(p,r);l.add(w,p)}l.setSpacing(a);return l};var a=function(){this.points={};this.spacing=void 0};a.prototype=
{add:function(b,a){void 0===this.points[b.hash()]&&(this.points[b.hash()]=a);return this},setSpacing:function(b){this.spacing=b;return this},getCoords:function(){return this.points},hasCoord:function(b){return void 0!==this.points[b.hash()]},getCoord:function(b){return this.points[b.hash()]},_debugDraw:function(b,a){for(var d in this.points){var e=this.points[d];b.circle(e.x(),e.y(),this.spacing/2).attr({fill:a,opacity:0.3})}}}})();
(function(){glift.displays.cropbox={LINE_EXTENSION:0.5,DEFAULT_EXTENSION:0,OVERFLOW:1.5,create:function(b,c,d,e){return new a(b,c,d,e)},getFromRegion:function(b,a){var d=glift.util,e=glift.enums.boardRegions;b=b||e.ALL;var g=a-1,h=Math.ceil(g/2),l=0,m=0,n=g,p=g,r=this.DEFAULT_EXTENSION,w=this.DEFAULT_EXTENSION,x=this.DEFAULT_EXTENSION,v=this.DEFAULT_EXTENSION;switch(b){case e.LEFT:p=h+1;v=this.LINE_EXTENSION;break;case e.RIGHT:m=h-1;w=this.LINE_EXTENSION;break;case e.TOP:n=h+1;x=this.LINE_EXTENSION;
break;case e.BOTTOM:l=h-1;r=this.LINE_EXTENSION;break;case e.TOP_LEFT:n=h+1;x=this.LINE_EXTENSION;p=h+2;v=this.LINE_EXTENSION;break;case e.TOP_RIGHT:n=h+1;x=this.LINE_EXTENSION;m=h-2;w=this.LINE_EXTENSION;break;case e.BOTTOM_LEFT:l=h-1;r=this.LINE_EXTENSION;p=h+2;v=this.LINE_EXTENSION;break;case e.BOTTOM_RIGHT:l=h-1,r=this.LINE_EXTENSION,m=h-2,v=this.LINE_EXTENSION}e=glift.displays.bboxFromPts(d.point(m,l),d.point(p,n));d=glift.displays.bboxFromPts(d.point(w,r),d.point(v,x));return glift.displays.cropbox.create(e,
d,0,g)}};var a=function(b,a,d,e){var g=glift.displays.cropbox.OVERFLOW;this.cbox=function(){return b};this.extBox=function(){return a};this.xPoints=function(){return b.width()};this.yPoints=function(){return b.height()};this.widthMod=function(){return b.width()+a.topLeft().x()+a.botRight().x()+g};this.heightMod=function(){return b.height()+a.topLeft().y()+a.botRight().y()+g}}})();
(function(){var a=glift.util;glift.displays.environment={TOPBAR_SIZE:0.1,BOTTOMBAR_SIZE:0.1,get:function(a){return new b(glift.displays.processOptions(a))},getInitialized:function(a){return glift.displays.environment.get(a).init()}};var b=function(a){this.divId=a.divId;this.boardRegion=a.boardRegion;this.intersections=a.intersections;this.cropbox=a.displayConfig._cropbox||glift.displays.cropbox.getFromRegion(this.boardRegion,this.intersections);this.widthOverride=this.heightOverride=!1;void 0!==a.displayConfig._divHeight&&
(this.divHeight=a.displayConfig._divHeight,this.heightOverride=!0);void 0!==a.displayConfig._divWidth&&(this.divWidth=a.displayConfig._divWidth,this.widthOverride=!0)};b.prototype={init:function(){(!this.heightOverride||!this.widthOverride)&&this._resetDimensions();var b=this.divHeight,d=this.divWidth,e=this.cropbox,b=glift.displays.bboxFromPts(a.point(0,0),a.point(d,b)),d=glift.displays.getResizedBox(b,e),e=glift.displays.getLineBox(d,e),g=glift.displays.boardPointsFromLineBox(e),h=glift.displays.getLineSegments(e);
this.divBox=b;this.goBoardBox=this.resizedBox=d;this.goBoardLineBox=e;this.boardPoints=g;this.lineSegments=h;return this},setIntersections:function(a){this.intersections=a},_resetDimensions:function(){this.divHeight=$("#"+this.divId).innerHeight();this.divWidth=$("#"+this.divId).innerWidth();this.needsInitialization=!0;return this},_debugDrawAll:function(){var a=Raphael(this.divId,"100%","100%");this.divBox.draw(a,"yellow");this.resizedBox.draw(a,"red");this.goBoardBox.draw(a,"orange");this.goBoardLineBox.bbox.draw(a,
"red");this.goBoardLineBox._debugDrawLines(a,"blue");this.boardPoints._debugDraw(a,"green");this.lineSegments._debugDraw(a,"black")}}})();
(function(){glift.displays.getLineBox=function(b,c){var d=glift.displays.cropbox.OVERFLOW,e=b.width()/c.widthMod(),g=b.height()/c.heightMod(),h=g*d/2,l=e*d/2,m=g*(c.heightMod()-d/2),d=e*(c.widthMod()-d/2),n=b.topLeft().x(),p=b.topLeft().y(),h=glift.displays.bboxFromPts(glift.util.point(l+n,h+p),glift.util.point(d+n,m+p));return new a(h,e,g,c)};var a=function(a,c,d,e){this.bbox=a;this._xSpacing=c;this._ySpacing=d;this.spacing=c;this.extensionBox=e.extBox();this.pointTopLeft=e.cbox().topLeft();this.xPoints=
e.xPoints();this.yPoints=e.yPoints()};a.prototype={_debugDrawLines:function(a,c){for(var d=this.bbox.left(),e=this.bbox.top();d<=this.bbox.right();d+=this.spacing,e+=this.spacing)a.rect(d,e,this.spacing,this.spacing).attr({fill:c,opacity:0.5})}}})();
(function(){glift.displays.getLineSegments=function(c){for(var d=new a,e=glift.util.point,g=c.spacing,h=c.bbox.left()+c.extensionBox.left()*g,l=c.bbox.top(),m=c.bbox.bottom(),n=0;n<=c.xPoints;n++){var p=h+n*g,r=c.pointTopLeft.x()+n;d.vert.push(new b(e(p,l),e(p,m),r))}h=c.bbox.left();m=c.bbox.right();l=c.bbox.top()+c.extensionBox.top()*g;for(n=0;n<=c.yPoints;n++)p=l+n*g,r=c.pointTopLeft.y()+n,d.horz.push(new b(e(h,p),e(m,p),r));return d};var a=function(){this.horz=[];this.vert=[]};a.prototype._debugDraw=
function(a,b){for(var e=glift.displays.raphael.rutil,g=[this.horz,this.vert],h=0;h<g.length;h++)for(var l=g[h],m=0;m<l.length;m++)a.path(e.svgMovePt(l[m].topLeft)+e.svgLineAbsPt(l[m].botRight))};var b=function(a,b,e){this.topLeft=a;this.botRight=b;this.ordinal=e}})();
glift.displays.processOptions=function(a){var b=function(a){this.name="DisplayOptionError";this.message=a};b.prototype=Error();var c={intersections:19,divId:"glift_display",theme:"DEFAULT",boardRegion:"ALL",displayConfig:{}},d;for(d in a){var e=a[d];switch(d){case "intersections":if("number"==glift.util.typeOf(e)&&0<e)c.intersections=e;else throw new b("Intersection value : "+d);break;case "theme":if(glift.themes.has(e))c.theme=e;else throw new b("Unknown theme: "+e);break;case "divId":if(null!==
document.getElementById(e))c.divId=e;else throw new b("Could not find div with id: "+e);break;case "boardRegion":if(void 0!==glift.enums.boardRegions[e])c.boardRegion=e;else throw new b("Unknown board region: "+e);break;case "displayConfig":if("object"===glift.util.typeOf(e))c.displayConfig=e;else throw new b("displayConfig not an object: "+e);break;default:glift.util.logz("Unknown option key: "+d)}}return c};
glift.displays.getResizedBox=function(a,b){var c=glift.util,d=glift.displays.getCropDimensions(a.width(),a.height(),b),e=d.width(),g=d.height(),h=a.width()-e,l=a.height()-g,m=0===h?0:h/2,n=0===l?0:l/2,p=a.topLeft().x()+m,r=a.topLeft().y()+n,c=glift.displays.bbox(c.point(p,r),e,g);c._debugInfo=function(){return{newDims:d,newWidth:e,newHeight:g,xDiff:h,yDiff:l,xDelta:m,yDelta:n,newLeft:p,newTop:r}};return c};
glift.displays.getCropDimensions=function(a,b,c){var d=b/a;c=c.heightMod()/c.widthMod();var e=b,g=a;d>c?e=a*c:d<c&&(g=b/c);return{height:function(){return e},width:function(){return g}}};
(function(){glift.displays.raphael={create:function(a,c){return new glift.displays.raphael.Display(a,c)}};glift.displays.raphael.Display=function(a,c){this._objectHistory=[];this._paper=glift.util.none;this._environment=a;this._themeName=c;this._theme=glift.themes.get(c);this._stones=glift.util.none;this.intersections=function(){return this._environment.intersections};this.divId=function(){return this._environment.divId};this.theme=function(){return this._themeName};this.boardRegion=function(){return this._environment.boardRegion}};
var a=glift.displays.raphael.Display;a.prototype.init=function(){this._paper=Raphael(this.divId(),"100%","100%");this._environment.init();return this};a.prototype.draw=function(){this.init();for(var a=0;a<this._objectHistory.length;a++)this._objectHistory[a].destroy();this._objectHistory=[this.createBoardBase(),this.createBoardLines(),this.createStarPoints()];this._stones=this.createStones();this._objectHistory.push(this._stones);return this};a.prototype.destroy=function(){for(var a=0;a<this._objectHistory.length;a++)this._objectHistory[a].destroy();
this._objectHistory=[];this._paper.remove();this._stones=this._paper=glift.util.none;$("#"+this.divId()).empty()};a.prototype.recreate=function(a){this.destroy();a=glift.displays.processOptions(a);this._environment=glift.displays.environment.get(a);this._themeName=a.theme;this._theme=glift.themes.get(a.theme);return this};a.prototype.setColor=function(a,c){if(this._stones!==glift.util.none)return this._stones.setColor(a,c),this;throw"Stones === none! Cannot setColor";};a.prototype.setClickHandler=
function(a){this._stones.setClickHandler(a)};a.prototype.setHoverInHandler=function(a){this._stones.setHoverInHandler(a)};a.prototype.setHoverOutHandler=function(a){this._stones.setHoverOutHandler(a)}})();
(function(){glift.displays.raphael.Display.prototype.createBoardBase=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,c,d){this.paper=a;this.environment=c;this.subtheme=d;this.rect=glift.util.none};a.prototype={draw:function(){var a=this.environment.goBoardBox;this.destroy();this.rect=this.paper.rect(a.topLeft().x(),a.topLeft().y(),a.width(),a.height());this.rect.attr({fill:this.subtheme.bgColor});return this},redraw:function(){return this.draw()},
destroy:function(){this.rect&&this.rect!==glift.util.none&&this.rect.remove();return this}}})();
(function(){glift.displays.raphael.Display.prototype.createBoardLines=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,b,e){this.paper=a;this.environment=b;this.subtheme=e;this.vertSet=this.horzSet=glift.util.none};a.prototype={draw:function(){this.destroy();var a=this.paper,d=this.subtheme,e=this.environment.lineSegments,g=this.environment.intersections;this.horzSet=b(a,e.horz,g,d.lineSize,d.edgeLineSize);this.vertSet=b(a,e.vert,g,d.lineSize,d.edgeLineSize);
return this},destroy:function(){this.horzSet&&this.horzSet!==glift.util.none&&this.horzSet.remove();this.vertSet&&this.vertSet!==glift.util.none&&this.vertSet.remove();return this}};var b=function(a,b,e,g,h){for(var l=a.set(),m=glift.displays.raphael.rutil,n=0;n<b.length;n++){var p=a.path(m.svgMovePt(b[n].topLeft)+m.svgLineAbsPt(b[n].botRight)),r=b[n].ordinal;p.attr({"stroke-linecap":"round","stroke-width":0===r||r===e-1?h:g});l.push(p)}return l}})();
(function(){glift.displays.raphael.Display.prototype.createMarks=function(){return new a(this._paper,this._environment,this._theme.marks)};var a=function(a,c,d){this.paper=a;this.environment=c;this.subtheme=d;this.marks={}};a.prototype={addMark:function(a,c,d){switch(a){case "XMARK":_addXMark(c,d)}return this},_addXMark:function(a,c){a.hash()},clearMark:function(a){},clearMarks:function(){}}})();
glift.displays.raphael.rutil={svgMove:function(a,b){return"M"+a+","+b},svgMovePt:function(a){return glift.displays.raphael.rutil.svgMove(a.x(),a.y())},svgLineRel:function(a,b){return"l"+a+","+b},svgLineRelPt:function(a){return glift.displays.raphael.rutil.svgLineRel(a.x(),a.y())},svgLineAbs:function(a,b){return"L"+a+","+b},svgLineAbsPt:function(a){return glift.displays.raphael.rutil.svgLineAbs(a.x(),a.y())}};
(function(){glift.displays.raphael.Display.prototype.createStarPoints=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,c,d){this.paper=a;this.environment=c;this.subtheme=d;this.starSet=glift.util.none};a.prototype={draw:function(){this.destroy();for(var a=glift.util.point,c=this.environment.boardPoints,d=c.spacing*this.subtheme.starPointSize,e={9:[[4]],13:[[3,9],[6]],19:[[3,9,15]]}[this.environment.intersections]||[],g=this.paper.set(),h=0;h<e.length;h++)for(var l=
e[h],m=0;m<l.length;m++)for(var n=0;n<l.length;n++){var p=a(l[m],l[n]);c.hasCoord(p)&&(p=c.getCoord(p),g.push(this.paper.circle(p.x(),p.y(),d)))}g.attr({fill:this.subtheme.lineColor});this.starSet=g;return this},redraw:function(){return this.draw()},destroy:function(){this.starSet&&this.starSet!==glift.util.none&&this.starSet.remove();return this}}})();
(function(){glift.displays.raphael.Display.prototype.createStones=function(){return(new a(this._paper,this._environment,this._theme.stones)).draw()};var a=function(a,b,e){this.paper=a;this.environment=b;this.subtheme=e;this.stoneMap={}};a.prototype={draw:function(){var a={},d=this.environment.boardPoints,e;for(e in d.points){var g=d.points[e],h=glift.util.pointFromHash(e),g=new b(this.paper,h,g,d.spacing,this.subtheme);a[e]=g.draw()}this.stoneMap=a;return this},setClickHandler:function(a){return this._handler("clickHandler",
a)},setHoverInHandler:function(a){return this._handler("hoverInHandler",a)},setHoverOutHandler:function(a){return this._handler("hoverOutHandler",a)},_handler:function(a,b){for(var e in this.stoneMap)this.stoneMap[e][a]=b;return this},forceClick:function(a){this.stoneMap[a.hash()].bboxClick()},forceHoverIn:function(a){this.stoneMap[a.hash()].bboxHoverIn()},forceHoverOut:function(a){this.stoneMap[a.hash()].bboxHoverOut()},setColor:function(a,b){var e=this.stoneMap[a.hash()];if(void 0===e)throw"Could not find stone for point: "+
a.toString();e.setColor(b);return this},destroy:function(){for(var a in this.stoneMap)this.stoneMap[a].destroy();this.stoneMap={}}};var b=function(a,b,e,g,h){this.paper=a;this.intersection=b;this.coordinate=e;this.subtheme=h;this.radius=g/2-0.2;this.bbox=this.circle=glift.util.none;this.bboxHoverIn=function(){throw"bboxHoverIn not Defined";};this.bboxHoverOut=function(){throw"bboxHoverOut not defined";};this.bboxClick=function(){throw"bboxClick not defined";};this.clickHandler=function(a){};this.hoverInHandler=
function(a){};this.hoverOutHandler=function(a){}};b.prototype={draw:function(){var a=this.paper,b=this.radius,e=this.coordinate,g=this.intersection,h=this;this.circle=a.circle(e.x(),e.y(),b);this.bbox=a.rect(e.x()-b,e.y()-b,2*b,2*b);this.bbox.attr({fill:"white",opacity:0});this.bboxHoverIn=function(){h.hoverInHandler(g)};this.bboxHoverOut=function(){h.hoverOutHandler(g)};this.bboxClick=function(){h.clickHandler(g)};this.bbox.hover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.click(this.bboxClick);
this.setColor("EMPTY");return this},setColor:function(a){if(this.circle===glift.util.none)throw"Circle was not initialized, so cannot set color";a in this.subtheme||glift.util.logz("Key "+a+" not found in theme");this.circle.attr(this.subtheme[a])},destroy:function(){if(this.circle===glift.util.none||this.bbox===glift.util.none)return this;this.bbox.unhover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.unclick(this.bboxClick);this.bbox.remove();this.circle.remove();return this},_bboxToFront:function(){this.bbox&&
this.bbox!==glift.util.non&&this.bbox.toFront();return this},addMark:function(a,b){}}})();glift.rules={};
(function(){var a=glift.util;glift.rules.goban={getInstance:function(a){return new b(a||19)},getFromMoveTree:function(a,d){var c=new b(a.getIntersections()),l=a.getTreeFromRoot();void 0===d&&(d=[]);c.loadStonesFromMovetree(l);for(var m=0;m<d.length;m++)l.moveDown(d[m]),c.loadStonesFromMovetree(l);return c}};var b=function(a){if(0>=a)throw"Intersections must be greater than 0";this.ints=a;for(var b=[],d=0;d<a;d++){for(var c=[],m=0;m<a;m++)c[m]=glift.enums.states.EMPTY;b[d]=c}this.stones=b};b.prototype=
{intersections:function(){return this.ints},getStone:function(a){return this.stones[a.y()][a.x()]},getAllPlacedStones:function(){for(var b=[],d=0;d<this.stones.length;d++)for(var c=this.stones[d],l=0;l<c.length;l++){var m=a.point(l,d),n=this.getStone(m);(n===glift.enums.states.BLACK||n===glift.enums.states.WHITE)&&b.push({point:m,color:n})}return b},placeable:function(a,b){return this.inBounds(a)&&this.getStone(a)===glift.enums.states.EMPTY},outBounds:function(b){return a.outBounds(b.x(),this.ints)||
a.outBounds(b.y(),this.ints)},inBounds:function(b){return a.inBounds(b.x(),this.ints)&&a.inBounds(b.y(),this.ints)},clearStone:function(a){this._setColor(a,glift.enums.states.EMPTY)},clearSome:function(a){for(var b=1;b<a.length;b++)this.clearStone(a[b])},_setColor:function(a,b){this.stones[a.y()][a.x()]=b},addStone:function(b,g){if(!a.colors.isLegalColor(g))throw"Unknown color: "+g;if(this.outBounds(b)||!this.placeable(b))return new d(!1);this._setColor(b,g);var h=new c,l=a.colors.oppositeColor(g);
this._getCaptures(h,a.point(b.x()+1,b.y()),l);this._getCaptures(h,a.point(b.x()-1,b.y()),l);this._getCaptures(h,a.point(b.x(),b.y()-1),l);this._getCaptures(h,a.point(b.x(),b.y()+1),l);if(0>=h.numCaptures&&(this._getCaptures(h,b,g),0<h.numCaptures))return this.clearStone(b),new d(!1);h=h.getCaptures();this.clearSome(h);return new d(!0,h)},_getCaptures:function(a,b,d){this._findConnected(a,b,d);0>=a.liberties&&a.consideringToCaptures();a.clearExceptCaptures()},_findConnected:function(b,d,c){if(!(void 0!==
b.seen[d.hash()]||this.outBounds(d))){b.seen[d.hash()]=!0;var l=this.getStone(d);if(l===glift.enums.states.EMPTY)b.liberties++;else if(l!==a.colors.oppositeColor(c))if(l===c)b.considering.push(d),this._findConnected(b,a.point(d.x()+1,d.y()),c),this._findConnected(b,a.point(d.x()-1,d.y()),c),this._findConnected(b,a.point(d.x(),d.y()+1),c),this._findConnected(b,a.point(d.x(),d.y()-1),c);else throw"Unknown color error: "+l;}},loadStonesFromMovetree:function(b){for(var d=[glift.enums.states.BLACK,glift.enums.states.WHITE],
c=0;c<d.length;c++)for(var l=b.getProperties().getPlacementsAsPoints(d[c]),m=0;m<l.length;m++)(this.placeable(l[m]),d[c])&&this.addStone(l[m],d[c]);b=b.getProperties().getMove();b!=a.none&&this.addStone(b.point,b.color)},_debug:function(){glift.util.logz(this.stones)}};var c=function(){this.toCapture={};this.numCaptures=0;this.considering=[];this.seen={};this.liberties=0};c.prototype={clearExceptCaptures:function(){this.considering=[];this.seen={};this.liberties=0},consideringToCaptures:function(){for(var a=
0;a<this.considering.length;a++){var b=this.considering[a];void 0===this.toCapture[b.hash()]&&(this.toCapture[b.hash()]=!0,this.numCaptures++)}},addLiberties:function(a){this.liberties+=a},addSeen:function(a){this.seen[a.hash()]=!0},getCaptures:function(){var b=[],d;for(d in this.toCapture)b.push(a.pointFromHash(d));return b}};var d=function(a,b){this.captures=(this.successful=a)?b:[]}})();
(function(){var a=glift.enums;glift.rules.intersections={propertiesToMarks:{CR:a.marks.CIRCLE,LB:a.marks.LETTER,MA:a.marks.XMARK,SQ:a.marks.SQUARE,TR:a.marks.TRIANGLE},getFullBoardData:function(b,c){for(var d={},e={},g=c.getAllPlacedStones(),h=0;h<g.length;h++){var l=g[h].point,m={point:l};m[a.marks.STONE]=g[h].color;e[l.hash()]=m}e=this.addCurrentMarks(e,b);d.points=e;b.getProperties().getComment()!==glift.util.none&&(d.comment=b.getProperties().getComment());return d},getChangeData:function(a,c,
d){},addCurrentMarks:function(a,c){for(var d in glift.rules.intersections.propertiesToMarks){var e=glift.rules.intersections.propertiesToMarks[d];if(c.getProperties().contains(d))for(var g=c.getProperties().get(d),h=0;h<g.length;h++){var l={},m=!0;d===glift.sgf.allProperties.LB?(m=glift.sgf.convertFromLabelData(g[h]),l=m.point,m=m.value):l=glift.sgf.sgfCoordToPoint(g[h]);var n=l.hash();void 0===a[n]&&(a[n]={point:l});a[n][e]=m}}return a}}})();
(function(){glift.rules.movenode=function(b,d){return new a(b,d)};var a=function(a,b){this.properties=a||glift.rules.properties();this.children=b||[];this.nodeId={nodeNum:0,varNum:0}};a.prototype={setNodeId:function(a,b){this.nodeId={nodeNum:a,varNum:b};return this},getNodeNum:function(){return this.nodeId.nodeNum},getVarNum:function(){return this.nodeId.varNum},numChildren:function(){return this.children.length},addChild:function(){this.children.push(glift.rules.movenode().setNodeId(this.getNodeNum()+
1,this.numChildren()));return this},getNext:function(a){return void 0===a?this.children[0]:this.children[a]},renumber:function(){b(this,this.nodeId.nodeNum,this.nodeId.varNum);return this}};var b=function(a,d,e){a.setNodeId(d,e);for(e=0;e<a.children.length;e++)b(a.children[e],d+1,e);return a}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.movetree={getInstance:function(a){a=a||19;var b=new c(glift.rules.movenode());b.setIntersections(a);return b},getFromSgf:function(a,b){void 0===b&&(b=[]);for(var g=new c(glift.sgf.parser.parse($.trim(a))),h=0;h<b.length;h++)g.moveDown(b[h]);return g},getFromNode:function(a){return new c(a)},searchMoveTreeDFS:function(a,b){b(a);for(var c=0;c<a.getNode().numChildren();c++)glift.rules.movetree.searchMoveTreeDFS(a.moveDown(c),b);a.moveUp()}};var c=
function(a){this._nodeHistory=[];this._nodeHistory.push(a)};c.prototype={getTreeFromRoot:function(){return glift.rules.movetree.getFromNode(this._nodeHistory[0])},getNode:function(){return this._nodeHistory[this._nodeHistory.length-1]},getProperties:function(){return this.getNode().properties},findNextMove:function(b,e){for(var c=this.getNode().children,h=glift.sgf.colorToToken(e),l={},m=0;m<c.length;m++){var n=c[m];n.properties.contains(h)&&(l[n.properties.getAsPoint(h).hash()]=n.getVarNum())}return void 0!==
l[b.hash()]?l[b.hash()]:a.none},getCurrentPlayer:function(){var d=this.getProperties().getMove();return d===a.none?b.states.BLACK:d.color===b.states.BLACK?b.states.WHITE:b.states.BLACK},moveDown:function(a){a=void 0===a?0:a;void 0!==this.getNode().getNext(a)&&(a=this.getNode().getNext(a),this._nodeHistory.push(a));return this},moveUp:function(){1<this._nodeHistory.length&&this._nodeHistory.pop();return this},moveToRoot:function(){this._nodeHistory=this._nodeHistory.slice(0,1);return this},addNewNode:function(){this.getNode().addChild();
this.moveDown(this.getNode().numChildren()-1);return this},deleteCurrentNode:function(){glift.rules.movetree.getNodeId();VarNum=this.getVarNum();this.moveUp();this.getAllNextNodes();return this},recurse:function(a){glift.rules.movetree.searchMoveTreeDFS(this,a)},recurseFromRoot:function(a){glift.rules.movetree.searchMoveTreeDFS(this.getTreeFromRoot(),a)},toSgf:function(){for(var a in this.getAllProps());},debugLog:function(a){void 0===a&&(a="  ");glift.util.logz(a+this.getNode(b).getVarNum()+"-"+
this.getNode(b).getNodeNum());for(var b=0;b<this.getNode().numChildren();b++)this.moveDown(b),this.debugLog(a),this.moveUp()},setIntersections:function(a){var b=this.getTreeFromRoot(),c=glift.sgf.allProperties;b.getProperties().contains(c.SZ)||this.getProperties().add(c.SZ,a+"");return this},getIntersections:function(){var a=this.getTreeFromRoot(),b=glift.sgf.allProperties;if(a.getNode().properties.contains(b.SZ))return parseInt(a.getNode().properties.get(b.SZ))},isCorrectPosition:function(){var a=
glift.enums.problemResults;if(this.getProperties().isCorrect())return a.CORRECT;for(var b=glift.rules.treepath.flattenMoveTree(this),c={},h=0;h<b.length;h++){for(var l=b[h],m=glift.rules.movetree.getFromNode(this.getNode()),n=!1,p=0;p<l.length;p++)m.moveDown(l[p]),m.getProperties().isCorrect()&&(n=!0);n?c[a.CORRECT]=!0:c[a.INCORRECT]=!0}return c[a.CORRECT]&&!c[a.INCORRECT]?a.CORRECT:c[a.CORRECT]&&c[a.INCORRECT]?a.INDETERMINATE:a.INCORRECT}}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.properties=function(a){return new c(a)};var c=function(a){this.propMap=void 0===a?{}:a};c.prototype={add:function(b,e){if(void 0===glift.sgf.allProperties[b])throw"Can't add undefined properties";"string"!==a.typeOf(e)&&"array"!==a.typeOf(e)&&(e=e.toString());e="string"===a.typeOf(e)?[e]:e;this.contains(b)?this.propMap[b]=this.get(b).concat(e):this.propMap[b]=e;return this},get:function(b){if(void 0===glift.sgf.allProperties[b])return a.debugl("attempted to retrieve a property that is not part of the SGF Spec: "+
b),a.none;if(void 0!==this.propMap[b])return this.propMap[b];a.debugl("no property: "+b+" exists for the current move");return a.none},getDatum:function(b,e){e=void 0!==e&&"number"===typeof e&&0<=e?e:0;var c=this.get(b);return c!==a.none&&1<=c.length?c[e]:a.none},getAsPoint:function(b,c){var g=this.getDatum(b,c);return g!==a.none?glift.sgf.sgfCoordToPoint(g):g},contains:function(b){return this.get(b)!==a.none},remove:function(b){if(this.contains(b)){var c=this.get(b);delete this.propMap[b];return c}return a.none},
replace:function(a,b){this.propMap[a]=b},getPlacementsAsPoints:function(a){var c="";a===b.states.BLACK?c=glift.sgf.allProperties.AB:a===b.states.WHITE&&(c=glift.sgf.allProperties.AW);return""===c||!this.contains(c)?[]:glift.sgf.allSgfCoordsToPoints(this.get(c))},getComment:function(){return this.contains("C")?this.getDatum("C"):a.none},getMove:function(){return this.contains("B")?{color:b.states.BLACK,point:glift.sgf.sgfCoordToPoint(this.getDatum("B"))}:this.contains("W")?{color:b.states.WHITE,point:glift.sgf.sgfCoordToPoint(this.getDatum("W"))}:
a.none},isCorrect:function(){return this.contains("GB")?!0:!1},getAllStones:function(){var b=glift.enums.states,c={},g=b.WHITE;c[b.BLACK]=this.getPlacementsAsPoints(b.BLACK);c[g]=this.getPlacementsAsPoints(b.WHITE);b=this.getMove();b!=a.none&&c[b.color].push(b.point);return c}}})();
glift.rules.treepath={parseInitPosition:function(a){if(void 0===a)return[];if("number"===glift.util.typeOf(a))a=""+a;else{if("array"===glift.util.typeOf(a))return a;if("string"!==glift.util.typeOf(a))return[]}var b=[],c=0;a=a.split("-");for(var d=0;d<a.length;d++){for(var e=a[d].split("."),g=0;g<e[0]-c;g++)b.push(0);c=e[0];for(g=1;g<e.length;g++)b.push(parseInt(e[g])),c++}return b},flattenMoveTree:function(a){for(var b=[],c=0;c<a.getNode().numChildren();c++){a.moveDown(c);var d=glift.rules.treepath._flattenMoveTree(a,
[]);a.moveUp();for(var e=0;e<d.length;e++)b.push(d[e])}return b},_flattenMoveTree:function(a,b){void 0===b&&(b=[]);b.push(a.getNode().getVarNum());for(var c=[],d=0;d<a.getNode().numChildren();d++){a.moveDown(d);var e=glift.rules.treepath._flattenMoveTree(a,b.slice()),c=c.concat(e);a.moveUp(d)}0==c.length&&c.push(b);return c}};
glift.sgf={colorToToken:function(a){if(a===glift.enums.states.WHITE)return"W";if(a===glift.enums.states.BLACK)return"B";throw"Unknown color-to-token conversion for: "+a;},sgfCoordToPoint:function(a){return glift.util.point(a.charCodeAt(0)-97,a.charCodeAt(1)-97)},allSgfCoordsToPoints:function(a){for(var b=[],c=0;c<a.length;c++)b.push(glift.sgf.sgfCoordToPoint(a[c]));return b},convertFromLabelData:function(a){a=a.split(":");return{point:glift.sgf.sgfCoordToPoint(a[0]),value:a[1]}},convertFromLabelArray:function(a){for(var b=
[],c=0;c<a.length;c++)b.push(glift.sgf.convertFromLabelData(a[c]));return b},pointToSgfCoord:function(a){return String.fromCharCode(a.x()+97)+String.fromCharCode(a.y()+97)}};
glift.sgf.allProperties={AB:"AB",AE:"AE",AN:"AN",AP:"AP",AR:"AR",AS:"AS",AW:"AW",B:"B",BL:"BL",BM:"BM",BR:"BR",BS:"BS",BT:"BT",C:"C",CA:"CA",CH:"CH",CP:"CP",CR:"CR",DD:"DD",DM:"DM",DO:"DO",DT:"DT",EL:"EL",EV:"EV",EX:"EX",FF:"FF",FG:"FG",GB:"GB",GC:"GC",GM:"GM",GN:"GN",GW:"GW",HA:"HA",HO:"HO",ID:"ID",IP:"IP",IT:"IT",IY:"IY",KM:"KM",KO:"KO",L:"L",LB:"LB",LN:"LN",LT:"LT",M:"M",MA:"MA",MN:"MN",N:"N",OB:"OB",OM:"OM",ON:"ON",OP:"OP",OT:"OT",OV:"OV",OW:"OW",PB:"PB",PC:"PC",PL:"PL",PM:"PM",PW:"PW",RE:"RE",
RG:"RG",RO:"RO",RU:"RU",SC:"SC",SE:"SE",SI:"SI",SL:"SL",SO:"SO",SQ:"SQ",ST:"ST",SU:"SU",SZ:"SZ",TB:"TB",TC:"TC",TE:"TE",TM:"TM",TR:"TR",TW:"TW",UC:"UC",US:"US",V:"V",VW:"VW",W:"W",WL:"WL",WR:"WR",WS:"WS",WT:"WT"};
glift.sgf.parser=function(){var a={parse:function(a,c){function d(a){var b=a.charCodeAt(0);if(255>=b){a="x";var c=2}else a="u",c=4;a="\\"+a;for(var e=b.toString(16).toUpperCase(),b=e,c=c-e.length,e=0;e<c;e++)b="0"+b;return a+b}function e(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,d)+'"'}function g(a){f<u||(f>u&&(u=f,y=[]),y.push(a))}function h(){var c="Variations@"+f,e=s[c];if(e)return f=e.nextPos,e.result;var d=e=f;
if("("===a.substr(f,1)){var k="(";f+=1}else k=null,q&&g('"("');if(null!==k){var h=m();if(null!==h){if(")"===a.substr(f,1)){var n=")";f+=1}else n=null,q&&g('")"');if(null!==n){var p=v(),p=null!==p?p:"";if(null!==p){if("("===a.substr(f,1)){var r="(";f+=1}else r=null,q&&g('"("');if(null!==r){var w=m();if(null!==w){if(")"===a.substr(f,1)){var x=")";f+=1}else x=null,q&&g('")"');if(null!==x){var t=v(),t=null!==t?t:"";if(null!==t){var u=l();null!==u?k=[k,h,n,p,r,w,x,t,u]:(k=null,f=d)}else k=null,f=d}else k=
null,f=d}else k=null,f=d}else k=null,f=d}else k=null,f=d}else k=null,f=d}else k=null,f=d}else k=null,f=d;d=null!==k?[k[1],k[5]].concat(k[8]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,d=m(),d=null!==d?void 0===d?[]:[d]:null,null===d&&(d=null,f=e),e=null!==d?d:null);s[c]={nextPos:f,result:e};return e}function l(){var c="MoreVars@"+f,e=s[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("("===a.substr(f,1)){var k="(";f+=1}else k=null,q&&g('"("');if(null!==k){var h=m();if(null!==h){if(")"===a.substr(f,
1)){var n=")";f+=1}else n=null,q&&g('")"');if(null!==n){var p=v(),p=null!==p?p:"";if(null!==p){var r=l();null!==r?k=[k,h,n,p,r]:(k=null,f=d)}else k=null,f=d}else k=null,f=d}else k=null,f=d}else k=null,f=d;d=null!==k?[k[1]].concat(k[4]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,q&&g('""')),d=null!==d?[]:null,null===d&&(d=null,f=e),e=null!==d?d:null);s[c]={nextPos:f,result:e};return e}function m(){var c="Moves@"+f,e=s[c];if(e)return f=e.nextPos,e.result;var d=
e=f;if(";"===a.substr(f,1)){var k=";";f+=1}else k=null,q&&g('";"');if(null!==k){var l=n();if(null!==l){var m=h();null!==m?k=[k,l,m]:(k=null,f=d)}else k=null,f=d}else k=null,f=d;d=null!==k?glift.rules.movenode(glift.rules.properties(k[1]),k[2]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,q&&g('""')),d=null!==d?void 0:null,null===d&&(d=null,f=e),e=null!==d?d:null);s[c]={nextPos:f,result:e};return e}function n(){var c="Tokens@"+f,d=s[c];if(d)return f=d.nextPos,
d.result;var e=d=f,k=x();if(null!==k){if("["===a.substr(f,1)){var h="[";f+=1}else h=null,q&&g('"["');if(null!==h){var l=r();if(null!==l){if("]"===a.substr(f,1)){var m="]";f+=1}else m=null,q&&g('"]"');if(null!==m){var n=v(),n=null!==n?n:"";if(null!==n){var t=w();if(null!==t){var u=v(),u=null!==u?u:"";if(null!==u){var y=p();null!==y?k=[k,h,l,m,n,t,u,y]:(k=null,f=e)}else k=null,f=e}else k=null,f=e}else k=null,f=e}else k=null,f=e}else k=null,f=e}else k=null,f=e}else k=null,f=e;null!==k?(e=k[7],e[k[0]]=
[k[2]].concat(k[5])):e=null;null===e&&(e=null,f=d);s[c]={nextPos:f,result:e};return e}function p(){var e="MoreTokens@"+f,c=s[e];if(c)return f=c.nextPos,c.result;c=n();if(null===c){c=f;if(""===a.substr(f,0)){var d="";f+=0}else d=null,q&&g('""');d=null!==d?{}:null;null===d&&(d=null,f=c);c=null!==d?d:null}s[e]={nextPos:f,result:c};return c}function r(){var e="Data@"+f,c=s[e];if(c)return f=c.nextPos,c.result;var c=f,d=[];if("\\]"===a.substr(f,2)){var k="\\]";f+=2}else k=null,q&&g('"\\\\]"');null===k&&
(null!==a.substr(f).match(/^[^\]]/)?(k=a.charAt(f),f++):(k=null,q&&g("[^\\]]")),k=null!==k?k:null);for(;null!==k;)d.push(k),"\\]"===a.substr(f,2)?(k="\\]",f+=2):(k=null,q&&g('"\\\\]"')),null===k&&(null!==a.substr(f).match(/^[^\]]/)?(k=a.charAt(f),f++):(k=null,q&&g("[^\\]]")),k=null!==k?k:null);d=null!==d?d.join(""):null;null===d&&(d=null,f=c);s[e]={nextPos:f,result:d};return d}function w(){var c="MoreData@"+f,d=s[c];if(d)return f=d.nextPos,d.result;var e=d=f;if("["===a.substr(f,1)){var k="[";f+=1}else k=
null,q&&g('"["');if(null!==k){var h=r();if(null!==h){if("]"===a.substr(f,1)){var l="]";f+=1}else l=null,q&&g('"]"');if(null!==l){var m=v(),m=null!==m?m:"";if(null!==m){var n=w();null!==n?k=[k,h,l,m,n]:(k=null,f=e)}else k=null,f=e}else k=null,f=e}else k=null,f=e}else k=null,f=e;e=null!==k?[k[1]].concat(k[4]):null;null===e&&(e=null,f=d);null!==e?d=e:(d=f,""===a.substr(f,0)?(e="",f+=0):(e=null,q&&g('""')),e=null!==e?[]:null,null===e&&(e=null,f=d),d=null!==e?e:null);s[c]={nextPos:f,result:d};return d}
function x(){var e="TokenName@"+f,d=s[e];if(d)return f=d.nextPos,d.result;var c=d=f;if(null!==a.substr(f).match(/^[a-zA-Z]/)){var k=a.charAt(f);f++}else k=null,q&&g("[a-zA-Z]");if(null!==k){if(null!==a.substr(f).match(/^[a-zA-Z]/)){var h=a.charAt(f);f++}else h=null,q&&g("[a-zA-Z]");null!==h?k=[k,h]:(k=null,f=c)}else k=null,f=c;null!==k?c=k:(null!==a.substr(f).match(/^[a-zA-Z]/)?(c=a.charAt(f),f++):(c=null,q&&g("[a-zA-Z]")),c=null!==c?c:null);c=null!==c?1===c.length?c[0]:c.join("").toUpperCase():null;
null===c&&(c=null,f=d);s[e]={nextPos:f,result:c};return c}function v(){var c="WhiteSpace@"+f,e=s[c];if(e)return f=e.nextPos,e.result;e=[];if(" "===a.substr(f,1)){var d=" ";f+=1}else d=null,q&&g('" "');null===d&&("\n"===a.substr(f,1)?(d="\n",f+=1):(d=null,q&&g('"\\n"')),d=null!==d?d:null);for(;null!==d;)e.push(d)," "===a.substr(f,1)?(d=" ",f+=1):(d=null,q&&g('" "')),null===d&&("\n"===a.substr(f,1)?(d="\n",f+=1):(d=null,q&&g('"\\n"')),d=null!==d?d:null);s[c]={nextPos:f,result:e};return e}function z(){var d;
a:{d=y;d.sort();for(var c=null,g=[],k=0;k<d.length;k++)d[k]!==c&&(g.push(d[k]),c=d[k]);switch(g.length){case 0:d="end of input";break a;case 1:d=g[0];break a;default:d=g.slice(0,g.length-1).join(", ")+" or "+g[g.length-1]}}c=Math.max(f,u);c=c<a.length?e(a.charAt(c)):"end of input";return"Expected "+d+" but "+c+" found."}function A(){for(var d=1,c=1,e=!1,f=0;f<u;f++){var g=a.charAt(f);"\n"===g?(e||d++,c=1,e=!1):"\r"===g|"\u2028"===g||"\u2029"===g?(d++,c=1,e=!0):(c++,e=!1)}return{line:d,column:c}}var t=
{Data:r,MoreData:w,MoreTokens:p,MoreVars:l,Moves:m,Start:function(){var d="Start@"+f,c=s[d];if(c)return f=c.nextPos,c.result;var e=c=f;if("(;"===a.substr(f,2)){var k="(;";f+=2}else k=null,q&&g('"(;"');if(null!==k){var l=n();if(null!==l){var m=h();if(null!==m){if(")"===a.substr(f,1)){var p=")";f+=1}else p=null,q&&g('")"');null!==p?k=[k,l,m,p]:(k=null,f=e)}else k=null,f=e}else k=null,f=e}else k=null,f=e;e=null!==k?glift.rules.movenode(glift.rules.properties(k[1]),k[2]).renumber():null;null===e&&(e=
null,f=c);s[d]={nextPos:f,result:e};return e},TokenName:x,Tokens:n,Variations:h,WhiteSpace:v};if(void 0!==c){if(void 0===t[c])throw Error("Invalid rule name: "+e(c)+".");}else c="Start";var f=0,q=!0,u=0,y=[],s={},t=t[c]();if(null===t||f!==a.length)throw t=A(),new this.SyntaxError(z(),t.line,t.column);return t},toSource:function(){return this._source},SyntaxError:function(a,c,d){this.name="SyntaxError";this.message=a;this.line=c;this.column=d}};a.SyntaxError.prototype=Error.prototype;return a}();
glift.controllers={controllerMap:{},create:function(a){var b=glift.controllers.processOptions(b);if(b.controllerType in glift.controllers.controllerMap)return glift.controllers.controllerMap[b.controllerType](b);throw"No controller found for type: "+b.controllerType;}};
(function(){var a=glift.enums.controllerMessages,b=glift.enums.controllerTypes.BASE;glift.controllers.baseController={create:function(){return new c}};glift.controllers.controllerMap[b]=glift.controllers.baseController.create;var c=function(){};c.prototype={nextSgf:function(a){throw"Not Implemented";},addStone:function(a){throw"Not Implemented";},initialize:function(a,b,c){var h=glift.rules;this.initPosition=h.treepath.parseInitPosition(b);this.movetree=h.movetree.getFromSgf(a,this.initPosition);
this.goban=h.goban.getFromMoveTree(this.movetree,this.initPosition);this.getEntireBoardState(c)},getEntireBoardState:function(b){var c=glift.rules.intersections.getFullBoardData(this.movetree,this.goban);b({message:a.CONTINUE,data:c})},canAddStone:function(b,c,g){this.goban.placeable(b,c)?g({message:a.CONTINUE}):g({message:a.FAILURE})},getCurrentPlayer:function(a){return this.movetree.getCurrentPlayer()},getIntersections:function(a){return this.movetree.getIntersections()}}})();
glift.controllers.processOptions=function(a){var b=function(a){this.name="DisplayOptionError";this.message=a};b.prototype=Error();var c={controllerType:"STATIC_PROBLEM_STUDY",initialPosition:[0],sgfString:""},d;for(d in a){var e=a[d];switch(d){case "controllerType":if("string"==glift.util.typeOf(e)&&e in glift.enums.controllerTypes)c.controllerType=e;else throw new b("Unknown controllerType: "+e);break;case "initialPosition":c.initialPosition=glift.rules.parseInitPosition(e);break;case "sgfString":if("string"==
glift.util.typeOf(e))c.sgfString=e;else throw new b("Bad type for sgfString: "+e);break;default:glift.util.logz("Unknown option key: "+d)}}return c};
(function(){var a=glift.enums.controllerMessages,b=glift.util,c=glift.enums.controllerTypes.STATIC_PROBLEM_STUDY;glift.controllers.staticProblemStudy={create:function(a){var c=glift.util.beget(glift.controllers.baseController.create()),c=b.setMethods(c,d);c.initOptions(a);return c}};glift.controllers.controllerMap[c]=glift.controllers.staticProblemStudy.create;var d={initOptions:function(a){this.sgfString=a.sgfString;this.initialPosition=a.initialPosition;return this},nextSgf:function(a){if(""!==
this.sgfString)this.staticStringNextSgf(a);else if(void 0!==options.sgfDataLocation)throw this.sgfDataLocation=options.sgfDataLocation,"Not implemented";},staticStringNextSgf:function(a){this.initialize(this.sgfString,this.initPosition,a)},addStone:function(c,d,h){if(!this.goban.addStone(c,d).successful)return h({message:a.FAILURE,reason:"Cannot add stone"}),b.none;var l=glift.enums.problemResults,m=this.movetree.findNextMove(c,d);this.lastPlayed={point:c,color:d};if(m===b.none)return h({message:a.DONE,
result:l.INCORRECT}),b.none;this.movetree.moveDown(m);c=this.movetree.isCorrectPosition();d=glift.rules.intersections.getFullBoardData(this.movetree,this.goban);if(c===l.CORRECT)return h({message:a.DONE,result:l.CORRECT,data:d}),b.none;if(c===l.INDETERMINATE)return c=glift.math.getRandomInt(0,this.movetree.getNode().numChildren()-1),this.movetree.moveDown(c),c=this.movetree.getProperties().getMove(),this.goban.addStone(c.point,c.color),d=glift.rules.intersections.getFullBoardData(this.movetree,this.goban),
h({message:a.CONTINUE,result:l.INDETERMINATE,data:d}),b.none;if(c===l.INCORRECT)return h({message:a.DONE,result:l.INCORRECT}),b.none;throw"Unexpected result output: "+c;}}})();glift.bridge={};
glift.bridge.getFromMovetree=function(a){var b=glift.displays.bboxFromPts,c=glift.util.point,d=glift.enums.boardRegions,e=a.getIntersections()-1,g=Math.ceil(e/2),h={},l={},m=0;h[d.TOP_LEFT]=b(c(0,0),c(g+1,g+1));h[d.TOP_RIGHT]=b(c(g-1,0),c(e,g+1));h[d.BOTTOM_LEFT]=b(c(0,g-1),c(g+1,e));h[d.BOTTOM_RIGHT]=b(c(g-1,g-1),c(e,e));a.recurseFromRoot(function(a){a=a.getProperties().getAllStones();for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];m+=1;for(var g in h)h[g].contains(e)&&(void 0===l[g]&&
(l[g]=[]),l[g].push(e))}});return glift.bridge._getRegionFromTracker(l,m)};glift.bridge._getRegionFromTracker=function(a,b){var c=[],d;for(d in a){if(a[d].length===b)return d;c.push(d)}if(2!==c.length)return glift.boardRegions.ALL;var c=glift.util.intersection(glift.util.regions.getComponents(c[0]),glift.util.regions.getComponents(c[1])),e;for(e in c)return e;return glift.boardRegions.ALL};
