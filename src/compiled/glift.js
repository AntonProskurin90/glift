(function(){var a=window.glift||{};a.createDisplay=function(b){return a.displays.create(b)};a.createController=function(b){return a.controllers.create(b)};window.glift=a})();
glift.util={logz:function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);console.log(""+b);return glift.util.none},beget:function(a){var b=function(){};b.prototype=a;return new b},typeOf:function(a){var b=typeof a;"object"===b&&(a?a instanceof Array&&(b="array"):b="null");return b},isArray:function(a){return a&&"object"===typeof a&&a.constructor===Array},inBounds:function(a,b){return a<b&&0<=a},outBounds:function(a,b){return a>=b||0>a},intersection:function(a,
b){var c={},e;for(e in a)void 0!==b[e]&&(c[e]=1);return c},getKeyWithDefault:function(a,b,c){void 0===a[b]&&(a[b]=c);return a[b]},sizeOf:function(a){var b=0,c;for(c in a)b+=1;return b},varDefined:function(a,b){var c=b||"";if(void 0===a)throw"Argument cannot be undefined"+(""!==c?": "+c:c);},defined:function(){for(var a=0;a<arguments.length;a++)if(void 0===arguments[a])return!1;return!0},assertDefined:function(a,b){if(void 0===a)throw b;return glift.util.none},checkArgsDefined:function(a,b){for(var c=
0;c<b;c++)if(void 0===a[c])throw"Argument "+c+" of "+a.length+" must be defined, but is undefined";return glift.util.none},setMethods:function(a,b){for(var c in b)a[c]=b[c].bind(a);return a}};glift.util.debugl=function(a){glift.debugOn&&glift.util.log(a)};glift.util.log=function(a){("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))&&JSON.stringify(a);void 0!==console&&void 0!==console.log&&console.log(a)};
(function(){var a=function(){this.type="none"};a.prototype={toString:function(){return"None"}};glift.util.none=new a})();glift.util.colors={isLegalColor:function(a){return a===glift.enums.states.BLACK||a===glift.enums.states.WHITE||a===glift.enums.states.EMPTY},oppositeColor:function(a){return a===glift.enums.states.BLACK?glift.enums.states.WHITE:a===glift.enums.states.WHITE?glift.enums.states.BLACK:a}};
glift.enums={states:{BLACK:"BLACK",WHITE:"WHITE",EMPTY:"EMPTY"},directions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},boardRegions:{LEFT:"LEFT",RIGHT:"RIGHT",TOP:"TOP",BOTTOM:"BOTTOM",TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT",ALL:"ALL"},marks:{CIRCLE:"CIRCLE",LETTER:"LETTER",SQUARE:"SQUARE",STONE:"STONE",TRIANGLE:"TRIANGLE",XMARK:"XMARK"},problemResults:{CORRECT:"CORRECT",
INCORRECT:"INCORRECT",INDETERMINATE:"INDETERMINATE"},controllerMessages:{CONTINUE:"CONTINUE",DONE:"DONE",FAILURE:"FAILURE"},controllerTypes:{BASE:"CONTROLLER_BASE",STATIC_PROBLEM_STUDY:"STATIC_PROBLEM_STUDY",DYNAMIC_PROBLEM_STUDY:"DYNAMIC_PROBLEM_STUDY",EXLORE_SOLUTIONS:"EXPLORE_SOLUTIONS",EXLORE_GAME:"EXPLORE_GAME"}};(function(){glift.errors={};glift.errors.ParseError=function(a){this.name="ParseError";this.message=a||""};glift.errors.ParseError.prototype=Error()})();
(function(){glift.logger=function(a,b){return new glift.Log(a,b)};glift.Log=function(a,b){this.name="#"+a;this.num=b;this.curMsgs=0};glift.Log.prototype.println=function(a){var b=a;if("array"===glift.util.typeOf(a)||"object"===glift.util.typeOf(a))b=JSON.stringify(a);$("<p>"+b+"</p>").appendTo(this.name);this.curMsgs++;this.curMsgs>this.num&&($(this.name).children("p:first").remove(),this.curMsgs-=1)};glift.Log.prototype.printv=function(){for(var a=arguments,b="",b=a[0],c=1;c<a.length;c++)b=b+","+
a[c];this.println(b)};glift.Log.prototype.log=glift.Log.prototype.println;glift.Log.prototype.printArr=function(a){for(var b=0;b<a.length;b++)this.println(a[b].toString());this.println("----")}})();glift.math={abs:function(a){return 0<=a?a:-1*a},max:function(a,b){return a>b?a:b},min:function(a,b){return a>b?b:a},isEven:function(a){return 0==a%2?!0:!1},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}};
(function(){var a={};glift.util.point=function(c,e){var d=glift.util.coordToString(c,e);if(void 0!==a[d])return a[d];var h=new b(c,e);return a[d]=h};glift.util.uncachedPoint=function(a,e){return new b(a,e)};glift.util._cacheHasPoint=function(b,e){return void 0!==a[glift.util.coordToString(b,e)]};var b=function(b,a){this.x=function(){return b};this.y=function(){return a};this.equals=function(d){return b===d.x()&&a===d.y()};this.toSgfCoord=function(){return String.fromCharCode(b+97)+String.fromCharCode(a+
97)}};b.prototype={hash:function(){return this.toString()},toString:function(){return glift.util.coordToString(this.x(),this.y())},value:function(){return this.toString()},log:function(){glift.util.logz(this.toString())}};glift.util.coordToString=function(b,a){return b+","+a};glift.util.pointFromString=function(b){try{var a=b.split(","),d=parseInt(a[0]),h=parseInt(a[1]);return glift.util.point(d,h)}catch(g){throw"Parsing Error! Couldn't parse a point from: "+b;}};glift.util.pointFromHash=function(b){return glift.util.pointFromString(b)}})();
glift.util.regions={getComponents:function(a){var b=glift.enums.boardRegions,c={};a===b.TOP_LEFT?(c[b.TOP]=1,c[b.LEFT]=1):a===b.TOP_RIGHT?(c[b.TOP]=1,c[b.RIGHT]=1):a===b.BOTTOM_LEFT?(c[b.BOTTOM]=1,c[b.LEFT]=1):a===b.BOTTOM_RIGHT&&(c[b.BOTTOM]=1,c[b.RIGHT]=1);return c}};
glift.testUtil={getAllElements:function(a){var b=[];a.forEach(function(a){b.push(a)});return b},assertEmptyPaper:function(a){a=glift.testUtil.getAllElements(a);deepEqual(a.length,0,"Paper should have been emptied")},assertFullDiv:function(a){ok(""!==$("#"+a).text(),"Div should contain contents")},assertEmptyDiv:function(a){deepEqual($("#"+a).text(),"","Div should not contain contents")}};
glift.themes={registered:{},get:function(a){var b=glift.themes.registered;return!(a in b)?glift.util.none:b[a]},has:function(a){return a in glift.themes.registered}};
glift.themes.registered.DEFAULT={board:{bgColor:"#f5be7e",lineColor:"black",lineSize:1,edgeLineSize:1,starPointSize:0.15,textColor:"white"},stones:{hoverOpacity:0.5,EMPTY:{fill:"blue",opacity:0},BLACK:{fill:"black",opacity:1,"stroke-width":1,stroke:"black"},BLACK_HOVER:{fill:"black",opacity:0.5},WHITE:{stroke:"black",fill:"white",opacity:1,"stroke-width":1},WHITE_HOVER:{fill:"white",opacity:0.5}},marks:{XMARK:{}}};
glift.displays={create:function(a){a=glift.displays.processOptions(a);var b=glift.displays.environment.get(a);return glift.displays.raphael.create(b,a.theme).draw()}};
(function(){glift.displays.bboxFromPts=function(b,c){return new a(b,c)};glift.displays.bbox=function(b,c,e){return new a(b,glift.util.point(b.x()+c,b.y()+e))};var a=function(b,a){this.topLeft=function(){return b};this.botRight=function(){return a};this.center=function(){return glift.util.point(glift.math.abs((a.x()-b.x())/2)+b.x(),glift.math.abs((a.y()-b.y())/2)+b.y())};this.width=function(){return a.x()-b.x()};this.height=function(){return a.y()-b.y()};this.top=function(){return b.y()};this.left=
function(){return b.x()};this.bottom=function(){return a.y()};this.right=function(){return a.x()}};a.prototype={draw:function(b,a){b.rect(this.topLeft().x(),this.topLeft().y(),this.width(),this.height()).attr({fill:a,opacity:0.5})},contains:function(b){return b.x()>=this.topLeft().x()&&b.x()<=this.botRight().x()&&b.y()>=this.topLeft().y()&&b.y()<=this.botRight().y()},log:function(){glift.util.logz("TopLeft: "+JSON.stringify(this.topLeft()));glift.util.logz("BotRight: "+JSON.stringify(this.botRight()));
glift.util.logz("Width: "+this.width());glift.util.logz("Height: "+this.height())},equals:function(b){return b.topLeft&&this.topLeft().equals(b.topLeft())&&b.botRight&&this.botRight().equals(b.botRight())}}})();
(function(){glift.displays.boardPoints=function(){return new a};glift.displays.boardPointsFromLineBox=function(b){for(var a=b.spacing,e=b.bbox,d=e.left()+b.extensionBox.left()*a,e=e.top()+b.extensionBox.top()*a,h=b.pointTopLeft.x(),g=b.pointTopLeft.y(),k=glift.displays.boardPoints(),l=0;l<=b.yPoints;l++)for(var m=0;m<=b.xPoints;m++){var n=d+m*a,p=e+l*a,v=glift.util.point(h+m,g+l),n=glift.util.point(n,p);k.add(v,n)}k.setSpacing(a);return k};var a=function(){this.points={};this.spacing=void 0};a.prototype=
{add:function(a,c){void 0===this.points[a.hash()]&&(this.points[a.hash()]=c);return this},setSpacing:function(a){this.spacing=a;return this},getCoords:function(){return this.points},hasCoord:function(a){return void 0!==this.points[a.hash()]},getCoord:function(a){return this.points[a.hash()]},_debugDraw:function(a,c){for(var e in this.points){var d=this.points[e];a.circle(d.x(),d.y(),this.spacing/2).attr({fill:c,opacity:0.3})}}}})();
(function(){glift.displays.cropbox={LINE_EXTENSION:0.5,DEFAULT_EXTENSION:0,OVERFLOW:1.5,create:function(b,c,e,d){return new a(b,c,e,d)},getFromRegion:function(a,c){var e=glift.util,d=glift.enums.boardRegions;a=a||d.ALL;var h=c-1,g=Math.ceil(h/2),k=0,l=0,m=h,n=h,p=this.DEFAULT_EXTENSION,v=this.DEFAULT_EXTENSION,w=this.DEFAULT_EXTENSION,x=this.DEFAULT_EXTENSION;switch(a){case d.LEFT:n=g+1;x=this.LINE_EXTENSION;break;case d.RIGHT:l=g-1;v=this.LINE_EXTENSION;break;case d.TOP:m=g+1;w=this.LINE_EXTENSION;
break;case d.BOTTOM:k=g-1;p=this.LINE_EXTENSION;break;case d.TOP_LEFT:m=g+1;w=this.LINE_EXTENSION;n=g+2;x=this.LINE_EXTENSION;break;case d.TOP_RIGHT:m=g+1;w=this.LINE_EXTENSION;l=g-2;v=this.LINE_EXTENSION;break;case d.BOTTOM_LEFT:k=g-1;p=this.LINE_EXTENSION;n=g+2;x=this.LINE_EXTENSION;break;case d.BOTTOM_RIGHT:k=g-1,p=this.LINE_EXTENSION,l=g-2,x=this.LINE_EXTENSION}d=glift.displays.bboxFromPts(e.point(l,k),e.point(n,m));e=glift.displays.bboxFromPts(e.point(v,p),e.point(x,w));return glift.displays.cropbox.create(d,
e,0,h)}};var a=function(a,c,e,d){var h=glift.displays.cropbox.OVERFLOW;this.cbox=function(){return a};this.extBox=function(){return c};this.xPoints=function(){return a.width()};this.yPoints=function(){return a.height()};this.widthMod=function(){return a.width()+c.topLeft().x()+c.botRight().x()+h};this.heightMod=function(){return a.height()+c.topLeft().y()+c.botRight().y()+h}}})();
(function(){var a=glift.util;glift.displays.environment={TOPBAR_SIZE:0.1,BOTTOMBAR_SIZE:0.1,get:function(a){return new b(glift.displays.processOptions(a))},getInitialized:function(a){return glift.displays.environment.get(a).init()}};var b=function(a){this.divId=a.divId;this.boardRegion=a.boardRegion;this.intersections=a.intersections;this.cropbox=a.displayConfig._cropbox||glift.displays.cropbox.getFromRegion(this.boardRegion,this.intersections);this.widthOverride=this.heightOverride=!1;void 0!==a.displayConfig._divHeight&&
(this.divHeight=a.displayConfig._divHeight,this.heightOverride=!0);void 0!==a.displayConfig._divWidth&&(this.divWidth=a.displayConfig._divWidth,this.widthOverride=!0)};b.prototype={init:function(){(!this.heightOverride||!this.widthOverride)&&this._resetDimensions();var b=this.divHeight,e=this.divWidth,d=this.cropbox,b=glift.displays.bboxFromPts(a.point(0,0),a.point(e,b)),e=glift.displays.getResizedBox(b,d),d=glift.displays.getLineBox(e,d),h=glift.displays.boardPointsFromLineBox(d),g=glift.displays.getLineSegments(d);
this.divBox=b;this.goBoardBox=this.resizedBox=e;this.goBoardLineBox=d;this.boardPoints=h;this.lineSegments=g;return this},setIntersections:function(a){this.intersections=a},_resetDimensions:function(){this.divHeight=$("#"+this.divId).innerHeight();this.divWidth=$("#"+this.divId).innerWidth();this.needsInitialization=!0;return this},_debugDrawAll:function(){var a=Raphael(this.divId,"100%","100%");this.divBox.draw(a,"yellow");this.resizedBox.draw(a,"red");this.goBoardBox.draw(a,"orange");this.goBoardLineBox.bbox.draw(a,
"red");this.goBoardLineBox._debugDrawLines(a,"blue");this.boardPoints._debugDraw(a,"green");this.lineSegments._debugDraw(a,"black")}}})();
(function(){glift.displays.getLineBox=function(b,c){var e=glift.displays.cropbox.OVERFLOW,d=b.width()/c.widthMod(),h=b.height()/c.heightMod(),g=h*e/2,k=d*e/2,l=h*(c.heightMod()-e/2),e=d*(c.widthMod()-e/2),m=b.topLeft().x(),n=b.topLeft().y(),g=glift.displays.bboxFromPts(glift.util.point(k+m,g+n),glift.util.point(e+m,l+n));return new a(g,d,h,c)};var a=function(a,c,e,d){this.bbox=a;this._xSpacing=c;this._ySpacing=e;this.spacing=c;this.extensionBox=d.extBox();this.pointTopLeft=d.cbox().topLeft();this.xPoints=
d.xPoints();this.yPoints=d.yPoints()};a.prototype={_debugDrawLines:function(a,c){for(var e=this.bbox.left(),d=this.bbox.top();e<=this.bbox.right();e+=this.spacing,d+=this.spacing)a.rect(e,d,this.spacing,this.spacing).attr({fill:c,opacity:0.5})}}})();
(function(){glift.displays.getLineSegments=function(c){for(var e=new a,d=glift.util.point,h=c.spacing,g=c.bbox.left()+c.extensionBox.left()*h,k=c.bbox.top(),l=c.bbox.bottom(),m=0;m<=c.xPoints;m++){var n=g+m*h,p=c.pointTopLeft.x()+m;e.vert.push(new b(d(n,k),d(n,l),p))}g=c.bbox.left();l=c.bbox.right();k=c.bbox.top()+c.extensionBox.top()*h;for(m=0;m<=c.yPoints;m++)n=k+m*h,p=c.pointTopLeft.y()+m,e.horz.push(new b(d(g,n),d(l,n),p));return e};var a=function(){this.horz=[];this.vert=[]};a.prototype._debugDraw=
function(a,b){for(var d=glift.displays.raphael.rutil,h=[this.horz,this.vert],g=0;g<h.length;g++)for(var k=h[g],l=0;l<k.length;l++)a.path(d.svgMovePt(k[l].topLeft)+d.svgLineAbsPt(k[l].botRight))};var b=function(a,b,d){this.topLeft=a;this.botRight=b;this.ordinal=d}})();
glift.displays.processOptions=function(a){var b=function(a){this.name="DisplayOptionError";this.message=a};b.prototype=Error();var c={intersections:19,divId:"glift_display",theme:"DEFAULT",boardRegion:"ALL",displayConfig:{}},e;for(e in a){var d=a[e];switch(e){case "intersections":if("number"==glift.util.typeOf(d)&&0<d)c.intersections=d;else throw new b("Intersection value : "+e);break;case "theme":if(glift.themes.has(d))c.theme=d;else throw new b("Unknown theme: "+d);break;case "divId":if(null!==
document.getElementById(d))c.divId=d;else throw new b("Could not find div with id: "+d);break;case "boardRegion":if(void 0!==glift.enums.boardRegions[d])c.boardRegion=d;else throw new b("Unknown board region: "+d);break;case "displayConfig":if("object"===glift.util.typeOf(d))c.displayConfig=d;else throw new b("displayConfig not an object: "+d);break;default:glift.util.logz("Unknown option key: "+e)}}return c};
glift.displays.getResizedBox=function(a,b){var c=glift.util,e=glift.displays.getCropDimensions(a.width(),a.height(),b),d=e.width(),h=e.height(),g=a.width()-d,k=a.height()-h,l=0===g?0:g/2,m=0===k?0:k/2,n=a.topLeft().x()+l,p=a.topLeft().y()+m,c=glift.displays.bbox(c.point(n,p),d,h);c._debugInfo=function(){return{newDims:e,newWidth:d,newHeight:h,xDiff:g,yDiff:k,xDelta:l,yDelta:m,newLeft:n,newTop:p}};return c};
glift.displays.getCropDimensions=function(a,b,c){var e=b/a;c=c.heightMod()/c.widthMod();var d=b,h=a;e>c?d=a*c:e<c&&(h=b/c);return{height:function(){return d},width:function(){return h}}};
(function(){glift.displays.raphael={create:function(a,c){return new glift.displays.raphael.Display(a,c)}};glift.displays.raphael.Display=function(a,c){this._objectHistory=[];this._paper=glift.util.none;this._environment=a;this._themeName=c;this._theme=glift.themes.get(c);this._stones=glift.util.none;this.intersections=function(){return this._environment.intersections};this.divId=function(){return this._environment.divId};this.theme=function(){return this._themeName};this.boardRegion=function(){return this._environment.boardRegion}};
var a=glift.displays.raphael.Display;a.prototype.init=function(){this._paper=Raphael(this.divId(),"100%","100%");this._environment.init();return this};a.prototype.draw=function(){this.init();for(var a=0;a<this._objectHistory.length;a++)this._objectHistory[a].destroy();this._objectHistory=[this.createBoardBase(),this.createBoardLines(),this.createStarPoints()];this._stones=this.createStones();this._objectHistory.push(this._stones);return this};a.prototype.destroy=function(){for(var a=0;a<this._objectHistory.length;a++)this._objectHistory[a].destroy();
this._objectHistory=[];this._paper.remove();this._stones=this._paper=glift.util.none;$("#"+this.divId()).empty()};a.prototype.recreate=function(a){this.destroy();a=glift.displays.processOptions(a);this._environment=glift.displays.environment.get(a);this._themeName=a.theme;this._theme=glift.themes.get(a.theme);return this};a.prototype.setColor=function(a,c){if(this._stones!==glift.util.none)return this._stones.setColor(a,c),this;throw"Stones === none! Cannot setColor";};a.prototype.setClickHandler=
function(a){this._stones.setClickHandler(a)};a.prototype.setHoverInHandler=function(a){this._stones.setHoverInHandler(a)};a.prototype.setHoverOutHandler=function(a){this._stones.setHoverOutHandler(a)}})();
(function(){glift.displays.raphael.Display.prototype.createBoardBase=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,c,e){this.paper=a;this.environment=c;this.subtheme=e;this.rect=glift.util.none};a.prototype={draw:function(){var a=this.environment.goBoardBox;this.destroy();this.rect=this.paper.rect(a.topLeft().x(),a.topLeft().y(),a.width(),a.height());this.rect.attr({fill:this.subtheme.bgColor});return this},redraw:function(){return this.draw()},
destroy:function(){this.rect&&this.rect!==glift.util.none&&this.rect.remove();return this}}})();
(function(){glift.displays.raphael.Display.prototype.createBoardLines=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,b,d){this.paper=a;this.environment=b;this.subtheme=d;this.vertSet=this.horzSet=glift.util.none};a.prototype={draw:function(){this.destroy();var a=this.paper,e=this.subtheme,d=this.environment.lineSegments,h=this.environment.intersections;this.horzSet=b(a,d.horz,h,e.lineSize,e.edgeLineSize);this.vertSet=b(a,d.vert,h,e.lineSize,e.edgeLineSize);
return this},destroy:function(){this.horzSet&&this.horzSet!==glift.util.none&&this.horzSet.remove();this.vertSet&&this.vertSet!==glift.util.none&&this.vertSet.remove();return this}};var b=function(a,b,d,h,g){for(var k=a.set(),l=glift.displays.raphael.rutil,m=0;m<b.length;m++){var n=a.path(l.svgMovePt(b[m].topLeft)+l.svgLineAbsPt(b[m].botRight)),p=b[m].ordinal;n.attr({"stroke-linecap":"round","stroke-width":0===p||p===d-1?g:h});k.push(n)}return k}})();
(function(){glift.displays.raphael.Display.prototype.createMarks=function(){return new a(this._paper,this._environment,this._theme.marks)};var a=function(a,c,e){this.paper=a;this.environment=c;this.subtheme=e;this.marks={}};a.prototype={addMark:function(a,c,e){switch(a){case "XMARK":_addXMark(c,e)}return this},_addXMark:function(a,c){a.hash()},clearMark:function(a){},clearMarks:function(){}}})();
glift.displays.raphael.rutil={svgMove:function(a,b){return"M"+a+","+b},svgMovePt:function(a){return glift.displays.raphael.rutil.svgMove(a.x(),a.y())},svgLineRel:function(a,b){return"l"+a+","+b},svgLineRelPt:function(a){return glift.displays.raphael.rutil.svgLineRel(a.x(),a.y())},svgLineAbs:function(a,b){return"L"+a+","+b},svgLineAbsPt:function(a){return glift.displays.raphael.rutil.svgLineAbs(a.x(),a.y())}};
(function(){glift.displays.raphael.Display.prototype.createStarPoints=function(){return(new a(this._paper,this._environment,this._theme.board)).draw()};var a=function(a,c,e){this.paper=a;this.environment=c;this.subtheme=e;this.starSet=glift.util.none};a.prototype={draw:function(){this.destroy();for(var a=glift.util.point,c=this.environment.boardPoints,e=c.spacing*this.subtheme.starPointSize,d={9:[[4]],13:[[3,9],[6]],19:[[3,9,15]]}[this.environment.intersections]||[],h=this.paper.set(),g=0;g<d.length;g++)for(var k=
d[g],l=0;l<k.length;l++)for(var m=0;m<k.length;m++){var n=a(k[l],k[m]);c.hasCoord(n)&&(n=c.getCoord(n),h.push(this.paper.circle(n.x(),n.y(),e)))}h.attr({fill:this.subtheme.lineColor});this.starSet=h;return this},redraw:function(){return this.draw()},destroy:function(){this.starSet&&this.starSet!==glift.util.none&&this.starSet.remove();return this}}})();
(function(){glift.displays.raphael.Display.prototype.createStones=function(){return(new a(this._paper,this._environment,this._theme.stones)).draw()};var a=function(a,b,d){this.paper=a;this.environment=b;this.subtheme=d;this.stoneMap={}};a.prototype={draw:function(){var a={},e=this.environment.boardPoints,d;for(d in e.points){var h=e.points[d],g=glift.util.pointFromHash(d),h=new b(this.paper,g,h,e.spacing,this.subtheme);a[d]=h.draw()}this.stoneMap=a;return this},setClickHandler:function(a){return this._handler("clickHandler",
a)},setHoverInHandler:function(a){return this._handler("hoverInHandler",a)},setHoverOutHandler:function(a){return this._handler("hoverOutHandler",a)},_handler:function(a,b){for(var d in this.stoneMap)this.stoneMap[d][a]=b;return this},forceClick:function(a){this.stoneMap[a.hash()].bboxClick()},forceHoverIn:function(a){this.stoneMap[a.hash()].bboxHoverIn()},forceHoverOut:function(a){this.stoneMap[a.hash()].bboxHoverOut()},setColor:function(a,b){var d=this.stoneMap[a.hash()];if(void 0===d)throw"Could not find stone for point: "+
a.toString();d.setColor(b);return this},destroy:function(){for(var a in this.stoneMap)this.stoneMap[a].destroy();this.stoneMap={}}};var b=function(a,b,d,h,g){this.paper=a;this.intersection=b;this.coordinate=d;this.subtheme=g;this.radius=h/2-0.2;this.bbox=this.circle=glift.util.none;this.bboxHoverIn=function(){throw"bboxHoverIn not Defined";};this.bboxHoverOut=function(){throw"bboxHoverOut not defined";};this.bboxClick=function(){throw"bboxClick not defined";};this.clickHandler=function(a){};this.hoverInHandler=
function(a){};this.hoverOutHandler=function(a){}};b.prototype={draw:function(){var a=this.paper,b=this.radius,d=this.coordinate,h=this.intersection,g=this;this.circle=a.circle(d.x(),d.y(),b);this.bbox=a.rect(d.x()-b,d.y()-b,2*b,2*b);this.bbox.attr({fill:"white",opacity:0});this.bboxHoverIn=function(){g.hoverInHandler(h)};this.bboxHoverOut=function(){g.hoverOutHandler(h)};this.bboxClick=function(){g.clickHandler(h)};this.bbox.hover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.click(this.bboxClick);
this.setColor("EMPTY");return this},setColor:function(a){if(this.circle===glift.util.none)throw"Circle was not initialized, so cannot set color";a in this.subtheme||glift.util.logz("Key "+a+" not found in theme");this.circle.attr(this.subtheme[a])},destroy:function(){if(this.circle===glift.util.none||this.bbox===glift.util.none)return this;this.bbox.unhover(this.bboxHoverIn,this.bboxHoverOut);this.bbox.unclick(this.bboxClick);this.bbox.remove();this.circle.remove();return this},_bboxToFront:function(){this.bbox&&
this.bbox!==glift.util.non&&this.bbox.toFront();return this},addMark:function(a,b){}}})();glift.rules={};
(function(){var a=glift.util;glift.rules.goban={getInstance:function(a){return new b(a||19)},getFromMoveTree:function(a,e){var c=new b(a.getIntersections()),k=a.getTreeFromRoot();void 0===e&&(e=[]);c.loadStonesFromMovetree(k);for(var l=0;l<e.length;l++)k.moveDown(e[l]),c.loadStonesFromMovetree(k);return c}};var b=function(a){if(0>=a)throw"Intersections must be greater than 0";this.ints=a;for(var b=[],e=0;e<a;e++){for(var c=[],l=0;l<a;l++)c[l]=glift.enums.states.EMPTY;b[e]=c}this.stones=b};b.prototype=
{intersections:function(){return this.ints},getStone:function(a){return this.stones[a.y()][a.x()]},getAllPlacedStones:function(){for(var b=[],e=0;e<this.stones.length;e++)for(var c=this.stones[e],k=0;k<c.length;k++){var l=a.point(k,e),m=this.getStone(l);(m===glift.enums.states.BLACK||m===glift.enums.states.WHITE)&&b.push({point:l,color:m})}return b},placeable:function(a,b){return this.inBounds(a)&&this.getStone(a)===glift.enums.states.EMPTY},outBounds:function(b){return a.outBounds(b.x(),this.ints)||
a.outBounds(b.y(),this.ints)},inBounds:function(b){return a.inBounds(b.x(),this.ints)&&a.inBounds(b.y(),this.ints)},clearStone:function(a){this._setColor(a,glift.enums.states.EMPTY)},clearSome:function(a){for(var b=1;b<a.length;b++)this.clearStone(a[b])},_setColor:function(a,b){this.stones[a.y()][a.x()]=b},addStone:function(b,h){if(!a.colors.isLegalColor(h))throw"Unknown color: "+h;if(this.outBounds(b)||!this.placeable(b))return new e(!1);this._setColor(b,h);var g=new c,k=a.colors.oppositeColor(h);
this._getCaptures(g,a.point(b.x()+1,b.y()),k);this._getCaptures(g,a.point(b.x()-1,b.y()),k);this._getCaptures(g,a.point(b.x(),b.y()-1),k);this._getCaptures(g,a.point(b.x(),b.y()+1),k);if(0>=g.numCaptures&&(this._getCaptures(g,b,h),0<g.numCaptures))return this.clearStone(b),new e(!1);g=g.getCaptures();this.clearSome(g);return new e(!0,g)},_getCaptures:function(a,b,e){this._findConnected(a,b,e);0>=a.liberties&&a.consideringToCaptures();a.clearExceptCaptures()},_findConnected:function(b,e,c){if(!(void 0!==
b.seen[e.hash()]||this.outBounds(e))){b.seen[e.hash()]=!0;var k=this.getStone(e);if(k===glift.enums.states.EMPTY)b.liberties++;else if(k!==a.colors.oppositeColor(c))if(k===c)b.considering.push(e),this._findConnected(b,a.point(e.x()+1,e.y()),c),this._findConnected(b,a.point(e.x()-1,e.y()),c),this._findConnected(b,a.point(e.x(),e.y()+1),c),this._findConnected(b,a.point(e.x(),e.y()-1),c);else throw"Unknown color error: "+k;}},loadStonesFromMovetree:function(b){for(var e=[glift.enums.states.BLACK,glift.enums.states.WHITE],
c=0;c<e.length;c++)for(var k=b.getProperties().getPlacementsAsPoints(e[c]),l=0;l<k.length;l++)(this.placeable(k[l]),e[c])&&this.addStone(k[l],e[c]);b=b.getProperties().getMove();b!=a.none&&this.addStone(b.point,b.color)},_debug:function(){glift.util.logz(this.stones)}};var c=function(){this.toCapture={};this.numCaptures=0;this.considering=[];this.seen={};this.liberties=0};c.prototype={clearExceptCaptures:function(){this.considering=[];this.seen={};this.liberties=0},consideringToCaptures:function(){for(var a=
0;a<this.considering.length;a++){var b=this.considering[a];void 0===this.toCapture[b.hash()]&&(this.toCapture[b.hash()]=!0,this.numCaptures++)}},addLiberties:function(a){this.liberties+=a},addSeen:function(a){this.seen[a.hash()]=!0},getCaptures:function(){var b=[],e;for(e in this.toCapture)b.push(a.pointFromHash(e));return b}};var e=function(a,b){this.captures=(this.successful=a)?b:[]}})();
(function(){var a=glift.enums;glift.rules.intersections={propertiesToMarks:{CR:a.marks.CIRCLE,LB:a.marks.LETTER,MA:a.marks.XMARK,SQ:a.marks.SQUARE,TR:a.marks.TRIANGLE},getFullBoardData:function(b,c){for(var e={},d={},h=c.getAllPlacedStones(),g=0;g<h.length;g++){var k=h[g].point,l={};l.point=k;l[a.marks.STONE]=h[g].color;d[k.hash()]=l}d=this.addCurrentMarks(d,b);e.points=d;b.getProperties().getComment()!==glift.util.none&&(e.comment=b.getProperties().getComment());return e},getChangeData:function(a,
c,e){},addCurrentMarks:function(a,c){for(var e in glift.rules.intersections.propertiesToMarks){var d=glift.rules.intersections.propertiesToMarks[e];if(c.getProperties().contains(e))for(var h=c.getProperties().get(e),g=0;g<h.length;g++){var k={},l=!0;e===glift.sgf.allProperties.LB?(l=glift.sgf.convertFromLabelData(h[g]),k=l.point,l=l.value):k=glift.sgf.sgfCoordToPoint(h[g]);var m=k.hash();void 0===a[m]&&(a[m]={point:k});a[m][d]=l}}return a}}})();
(function(){glift.rules.movenode=function(b,e){return new a(b,e)};var a=function(a,b){this.properties=a||glift.rules.properties();this.children=b||[];this.nodeId={nodeNum:0,varNum:0}};a.prototype={setNodeId:function(a,b){this.nodeId={nodeNum:a,varNum:b};return this},getNodeNum:function(){return this.nodeId.nodeNum},getVarNum:function(){return this.nodeId.varNum},numChildren:function(){return this.children.length},addChild:function(){this.children.push(glift.rules.movenode().setNodeId(this.getNodeNum()+
1,this.numChildren()));return this},getNext:function(a){return void 0===a?this.children[0]:this.children[a]},renumber:function(){b(this,this.nodeId.nodeNum,this.nodeId.varNum);return this}};var b=function(a,e,d){a.setNodeId(e,d);for(d=0;d<a.children.length;d++)b(a.children[d],e+1,d);return a}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.movetree={getInstance:function(a){a=a||19;var b=new c(glift.rules.movenode());b.setIntersections(a);return b},getFromSgf:function(a,b){void 0===b&&(b=[]);if(void 0===a||""===a)return glift.rules.movetree.getInstance(19);for(var h=new c(glift.sgf.parser.parse($.trim(a))),g=0;g<b.length;g++)h.moveDown(b[g]);return h},getFromNode:function(a){return new c(a)},searchMoveTreeDFS:function(a,b){b(a);for(var c=0;c<a.getNode().numChildren();c++)glift.rules.movetree.searchMoveTreeDFS(a.moveDown(c),
b);a.moveUp()}};var c=function(a){this._nodeHistory=[];this._nodeHistory.push(a)};c.prototype={getTreeFromRoot:function(){return glift.rules.movetree.getFromNode(this._nodeHistory[0])},getNode:function(){return this._nodeHistory[this._nodeHistory.length-1]},getProperties:function(){return this.getNode().properties},findNextMove:function(b,c){for(var h=this.getNode().children,g=glift.sgf.colorToToken(c),k={},l=0;l<h.length;l++){var m=h[l];m.properties.contains(g)&&(k[m.properties.getAsPoint(g).hash()]=
m.getVarNum())}return void 0!==k[b.hash()]?k[b.hash()]:a.none},getCurrentPlayer:function(){var e=this.getProperties().getMove();return e===a.none?b.states.BLACK:e.color===b.states.BLACK?b.states.WHITE:b.states.BLACK},moveDown:function(a){a=void 0===a?0:a;void 0!==this.getNode().getNext(a)&&(a=this.getNode().getNext(a),this._nodeHistory.push(a));return this},moveUp:function(){1<this._nodeHistory.length&&this._nodeHistory.pop();return this},moveToRoot:function(){this._nodeHistory=this._nodeHistory.slice(0,
1);return this},addNewNode:function(){this.getNode().addChild();this.moveDown(this.getNode().numChildren()-1);return this},deleteCurrentNode:function(){glift.rules.movetree.getNodeId();VarNum=this.getVarNum();this.moveUp();this.getAllNextNodes();return this},recurse:function(a){glift.rules.movetree.searchMoveTreeDFS(this,a)},recurseFromRoot:function(a){glift.rules.movetree.searchMoveTreeDFS(this.getTreeFromRoot(),a)},toSgf:function(){for(var a in this.getAllProps());},debugLog:function(a){void 0===
a&&(a="  ");glift.util.logz(a+this.getNode(b).getVarNum()+"-"+this.getNode(b).getNodeNum());for(var b=0;b<this.getNode().numChildren();b++)this.moveDown(b),this.debugLog(a),this.moveUp()},setIntersections:function(a){var b=this.getTreeFromRoot(),c=glift.sgf.allProperties;b.getProperties().contains(c.SZ)||this.getProperties().add(c.SZ,a+"");return this},getIntersections:function(){var a=this.getTreeFromRoot(),b=glift.sgf.allProperties;if(a.getNode().properties.contains(b.SZ))return parseInt(a.getNode().properties.get(b.SZ))},
isCorrectPosition:function(){var a=glift.enums.problemResults;if(this.getProperties().isCorrect())return a.CORRECT;for(var b=glift.rules.treepath.flattenMoveTree(this),c={},g=0;g<b.length;g++){for(var k=b[g],l=glift.rules.movetree.getFromNode(this.getNode()),m=!1,n=0;n<k.length;n++)l.moveDown(k[n]),l.getProperties().isCorrect()&&(m=!0);m?c[a.CORRECT]=!0:c[a.INCORRECT]=!0}return c[a.CORRECT]&&!c[a.INCORRECT]?a.CORRECT:c[a.CORRECT]&&c[a.INCORRECT]?a.INDETERMINATE:a.INCORRECT}}})();
(function(){var a=glift.util,b=glift.enums;glift.rules.properties=function(a){return new c(a)};var c=function(a){this.propMap=void 0===a?{}:a};c.prototype={add:function(b,c){if(void 0===glift.sgf.allProperties[b])throw"Can't add undefined properties";"string"!==a.typeOf(c)&&"array"!==a.typeOf(c)&&(c=c.toString());c="string"===a.typeOf(c)?[c]:c;this.contains(b)?this.propMap[b]=this.get(b).concat(c):this.propMap[b]=c;return this},get:function(b){if(void 0===glift.sgf.allProperties[b])return a.debugl("attempted to retrieve a property that is not part of the SGF Spec: "+
b),a.none;if(void 0!==this.propMap[b])return this.propMap[b];a.debugl("no property: "+b+" exists for the current move");return a.none},getDatum:function(b,c){c=void 0!==c&&"number"===typeof c&&0<=c?c:0;var h=this.get(b);return h!==a.none&&1<=h.length?h[c]:a.none},getAsPoint:function(b,c){var h=this.getDatum(b,c);return h!==a.none?glift.sgf.sgfCoordToPoint(h):h},contains:function(b){return this.get(b)!==a.none},remove:function(b){if(this.contains(b)){var c=this.get(b);delete this.propMap[b];return c}return a.none},
replace:function(a,b){this.propMap[a]=b},getPlacementsAsPoints:function(a){var c="";a===b.states.BLACK?c=glift.sgf.allProperties.AB:a===b.states.WHITE&&(c=glift.sgf.allProperties.AW);return""===c||!this.contains(c)?[]:glift.sgf.allSgfCoordsToPoints(this.get(c))},getComment:function(){return this.contains("C")?this.getDatum("C"):a.none},getMove:function(){return this.contains("B")?{color:b.states.BLACK,point:glift.sgf.sgfCoordToPoint(this.getDatum("B"))}:this.contains("W")?{color:b.states.WHITE,point:glift.sgf.sgfCoordToPoint(this.getDatum("W"))}:
a.none},isCorrect:function(){return this.contains("GB")?!0:!1},getAllStones:function(){var b=glift.enums.states,c={},h=b.WHITE;c[b.BLACK]=this.getPlacementsAsPoints(b.BLACK);c[h]=this.getPlacementsAsPoints(b.WHITE);b=this.getMove();b!=a.none&&c[b.color].push(b.point);return c}}})();
glift.rules.treepath={parseInitPosition:function(a){if(void 0===a)return[];if("number"===glift.util.typeOf(a))a=""+a;else{if("array"===glift.util.typeOf(a))return a;if("string"!==glift.util.typeOf(a))return[]}var b=[],c=0;a=a.split("-");for(var e=0;e<a.length;e++){for(var d=a[e].split("."),h=0;h<d[0]-c;h++)b.push(0);c=d[0];for(h=1;h<d.length;h++)b.push(parseInt(d[h])),c++}return b},flattenMoveTree:function(a){for(var b=[],c=0;c<a.getNode().numChildren();c++){a.moveDown(c);var e=glift.rules.treepath._flattenMoveTree(a,
[]);a.moveUp();for(var d=0;d<e.length;d++)b.push(e[d])}return b},_flattenMoveTree:function(a,b){void 0===b&&(b=[]);b.push(a.getNode().getVarNum());for(var c=[],e=0;e<a.getNode().numChildren();e++){a.moveDown(e);var d=glift.rules.treepath._flattenMoveTree(a,b.slice()),c=c.concat(d);a.moveUp(e)}0==c.length&&c.push(b);return c}};
glift.sgf={colorToToken:function(a){if(a===glift.enums.states.WHITE)return"W";if(a===glift.enums.states.BLACK)return"B";throw"Unknown color-to-token conversion for: "+a;},sgfCoordToPoint:function(a){return glift.util.point(a.charCodeAt(0)-97,a.charCodeAt(1)-97)},allSgfCoordsToPoints:function(a){for(var b=[],c=0;c<a.length;c++)b.push(glift.sgf.sgfCoordToPoint(a[c]));return b},convertFromLabelData:function(a){a=a.split(":");return{point:glift.sgf.sgfCoordToPoint(a[0]),value:a[1]}},convertFromLabelArray:function(a){for(var b=
[],c=0;c<a.length;c++)b.push(glift.sgf.convertFromLabelData(a[c]));return b},pointToSgfCoord:function(a){return String.fromCharCode(a.x()+97)+String.fromCharCode(a.y()+97)}};
glift.sgf.allProperties={AB:"AB",AE:"AE",AN:"AN",AP:"AP",AR:"AR",AS:"AS",AW:"AW",B:"B",BL:"BL",BM:"BM",BR:"BR",BS:"BS",BT:"BT",C:"C",CA:"CA",CH:"CH",CP:"CP",CR:"CR",DD:"DD",DM:"DM",DO:"DO",DT:"DT",EL:"EL",EV:"EV",EX:"EX",FF:"FF",FG:"FG",GB:"GB",GC:"GC",GM:"GM",GN:"GN",GW:"GW",HA:"HA",HO:"HO",ID:"ID",IP:"IP",IT:"IT",IY:"IY",KM:"KM",KO:"KO",L:"L",LB:"LB",LN:"LN",LT:"LT",M:"M",MA:"MA",MN:"MN",N:"N",OB:"OB",OM:"OM",ON:"ON",OP:"OP",OT:"OT",OV:"OV",OW:"OW",PB:"PB",PC:"PC",PL:"PL",PM:"PM",PW:"PW",RE:"RE",
RG:"RG",RO:"RO",RU:"RU",SC:"SC",SE:"SE",SI:"SI",SL:"SL",SO:"SO",SQ:"SQ",ST:"ST",SU:"SU",SZ:"SZ",TB:"TB",TC:"TC",TE:"TE",TM:"TM",TR:"TR",TW:"TW",UC:"UC",US:"US",V:"V",VW:"VW",W:"W",WL:"WL",WR:"WR",WS:"WS",WT:"WT"};
glift.sgf.parser=function(){var a={parse:function(a,c){function e(a){var b=a.charCodeAt(0);if(255>=b){a="x";var c=2}else a="u",c=4;a="\\"+a;for(var e=b.toString(16).toUpperCase(),b=e,c=c-e.length,e=0;e<c;e++)b="0"+b;return a+b}function d(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,e)+'"'}function h(a){f<y||(f>y&&(y=f,z=[]),z.push(a))}function g(){var c="Variations@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var r=e=f;
if("("===a.substr(f,1)){var d="(";f+=1}else d=null,q&&h('"("');if(null!==d){var g=l();if(null!==g){if(")"===a.substr(f,1)){var m=")";f+=1}else m=null,q&&h('")"');if(null!==m){var n=x(),n=null!==n?n:"";if(null!==n){if("("===a.substr(f,1)){var p="(";f+=1}else p=null,q&&h('"("');if(null!==p){var v=l();if(null!==v){if(")"===a.substr(f,1)){var w=")";f+=1}else w=null,q&&h('")"');if(null!==w){var u=x(),u=null!==u?u:"";if(null!==u){var y=k();null!==y?d=[d,g,m,n,p,v,w,u,y]:(d=null,f=r)}else d=null,f=r}else d=
null,f=r}else d=null,f=r}else d=null,f=r}else d=null,f=r}else d=null,f=r}else d=null,f=r}else d=null,f=r;r=null!==d?[d[1],d[5]].concat(d[8]):null;null===r&&(r=null,f=e);null!==r?e=r:(e=f,r=l(),r=null!==r?void 0===r?[]:[r]:null,null===r&&(r=null,f=e),e=null!==r?r:null);t[c]={nextPos:f,result:e};return e}function k(){var c="MoreVars@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("("===a.substr(f,1)){var s="(";f+=1}else s=null,q&&h('"("');if(null!==s){var g=l();if(null!==g){if(")"===a.substr(f,
1)){var m=")";f+=1}else m=null,q&&h('")"');if(null!==m){var n=x(),n=null!==n?n:"";if(null!==n){var p=k();null!==p?s=[s,g,m,n,p]:(s=null,f=d)}else s=null,f=d}else s=null,f=d}else s=null,f=d}else s=null,f=d;d=null!==s?[s[1]].concat(s[4]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,q&&h('""')),d=null!==d?[]:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}function l(){var c="Moves@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=
e=f;if(";"===a.substr(f,1)){var s=";";f+=1}else s=null,q&&h('";"');if(null!==s){var k=m();if(null!==k){var l=g();null!==l?s=[s,k,l]:(s=null,f=d)}else s=null,f=d}else s=null,f=d;d=null!==s?glift.rules.movenode(glift.rules.properties(s[1]),s[2]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,q&&h('""')),d=null!==d?void 0:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}function m(){var c="Tokens@"+f,e=t[c];if(e)return f=e.nextPos,
e.result;var d=e=f,g=w();if(null!==g){if("["===a.substr(f,1)){var k="[";f+=1}else k=null,q&&h('"["');if(null!==k){var l=p();if(null!==l){if("]"===a.substr(f,1)){var m="]";f+=1}else m=null,q&&h('"]"');if(null!==m){var u=x(),u=null!==u?u:"";if(null!==u){var y=v();if(null!==y){var A=x(),A=null!==A?A:"";if(null!==A){var z=n();null!==z?g=[g,k,l,m,u,y,A,z]:(g=null,f=d)}else g=null,f=d}else g=null,f=d}else g=null,f=d}else g=null,f=d}else g=null,f=d}else g=null,f=d}else g=null,f=d;null!==g?(d=g[7],d[g[0]]=
[g[2]].concat(g[5])):d=null;null===d&&(d=null,f=e);t[c]={nextPos:f,result:d};return d}function n(){var c="MoreTokens@"+f,e=t[c];if(e)return f=e.nextPos,e.result;e=m();if(null===e){e=f;if(""===a.substr(f,0)){var d="";f+=0}else d=null,q&&h('""');d=null!==d?{}:null;null===d&&(d=null,f=e);e=null!==d?d:null}t[c]={nextPos:f,result:e};return e}function p(){var c="Data@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var e=f,d=[];if("\\]"===a.substr(f,2)){var g="\\]";f+=2}else g=null,q&&h('"\\\\]"');null===g&&
(null!==a.substr(f).match(/^[^\]]/)?(g=a.charAt(f),f++):(g=null,q&&h("[^\\]]")),g=null!==g?g:null);for(;null!==g;)d.push(g),"\\]"===a.substr(f,2)?(g="\\]",f+=2):(g=null,q&&h('"\\\\]"')),null===g&&(null!==a.substr(f).match(/^[^\]]/)?(g=a.charAt(f),f++):(g=null,q&&h("[^\\]]")),g=null!==g?g:null);d=null!==d?d.join(""):null;null===d&&(d=null,f=e);t[c]={nextPos:f,result:d};return d}function v(){var c="MoreData@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("["===a.substr(f,1)){var g="[";f+=1}else g=
null,q&&h('"["');if(null!==g){var k=p();if(null!==k){if("]"===a.substr(f,1)){var l="]";f+=1}else l=null,q&&h('"]"');if(null!==l){var m=x(),m=null!==m?m:"";if(null!==m){var n=v();null!==n?g=[g,k,l,m,n]:(g=null,f=d)}else g=null,f=d}else g=null,f=d}else g=null,f=d}else g=null,f=d;d=null!==g?[g[1]].concat(g[4]):null;null===d&&(d=null,f=e);null!==d?e=d:(e=f,""===a.substr(f,0)?(d="",f+=0):(d=null,q&&h('""')),d=null!==d?[]:null,null===d&&(d=null,f=e),e=null!==d?d:null);t[c]={nextPos:f,result:e};return e}
function w(){var c="TokenName@"+f,d=t[c];if(d)return f=d.nextPos,d.result;var e=d=f;if(null!==a.substr(f).match(/^[a-zA-Z]/)){var g=a.charAt(f);f++}else g=null,q&&h("[a-zA-Z]");if(null!==g){if(null!==a.substr(f).match(/^[a-zA-Z]/)){var k=a.charAt(f);f++}else k=null,q&&h("[a-zA-Z]");null!==k?g=[g,k]:(g=null,f=e)}else g=null,f=e;null!==g?e=g:(null!==a.substr(f).match(/^[a-zA-Z]/)?(e=a.charAt(f),f++):(e=null,q&&h("[a-zA-Z]")),e=null!==e?e:null);e=null!==e?1===e.length?e[0]:e.join("").toUpperCase():null;
null===e&&(e=null,f=d);t[c]={nextPos:f,result:e};return e}function x(){var c="WhiteSpace@"+f,e=t[c];if(e)return f=e.nextPos,e.result;e=[];if(" "===a.substr(f,1)){var d=" ";f+=1}else d=null,q&&h('" "');null===d&&("\n"===a.substr(f,1)?(d="\n",f+=1):(d=null,q&&h('"\\n"')),d=null!==d?d:null);for(;null!==d;)e.push(d)," "===a.substr(f,1)?(d=" ",f+=1):(d=null,q&&h('" "')),null===d&&("\n"===a.substr(f,1)?(d="\n",f+=1):(d=null,q&&h('"\\n"')),d=null!==d?d:null);t[c]={nextPos:f,result:e};return e}function B(){var c;
a:{c=z;c.sort();for(var e=null,g=[],h=0;h<c.length;h++)c[h]!==e&&(g.push(c[h]),e=c[h]);switch(g.length){case 0:c="end of input";break a;case 1:c=g[0];break a;default:c=g.slice(0,g.length-1).join(", ")+" or "+g[g.length-1]}}e=Math.max(f,y);e=e<a.length?d(a.charAt(e)):"end of input";return"Expected "+c+" but "+e+" found."}function C(){for(var c=1,e=1,d=!1,f=0;f<y;f++){var g=a.charAt(f);"\n"===g?(d||c++,e=1,d=!1):"\r"===g|"\u2028"===g||"\u2029"===g?(c++,e=1,d=!0):(e++,d=!1)}return{line:c,column:e}}var u=
{Data:p,MoreData:v,MoreTokens:n,MoreVars:k,Moves:l,Start:function(){var c="Start@"+f,e=t[c];if(e)return f=e.nextPos,e.result;var d=e=f;if("(;"===a.substr(f,2)){var k="(;";f+=2}else k=null,q&&h('"(;"');if(null!==k){var l=m();if(null!==l){var n=g();if(null!==n){if(")"===a.substr(f,1)){var p=")";f+=1}else p=null,q&&h('")"');null!==p?k=[k,l,n,p]:(k=null,f=d)}else k=null,f=d}else k=null,f=d}else k=null,f=d;d=null!==k?glift.rules.movenode(glift.rules.properties(k[1]),k[2]).renumber():null;null===d&&(d=
null,f=e);t[c]={nextPos:f,result:d};return d},TokenName:w,Tokens:m,Variations:g,WhiteSpace:x};if(void 0!==c){if(void 0===u[c])throw Error("Invalid rule name: "+d(c)+".");}else c="Start";var f=0,q=!0,y=0,z=[],t={},u=u[c]();if(null===u||f!==a.length)throw u=C(),new this.SyntaxError(B(),u.line,u.column);return u},toSource:function(){return this._source},SyntaxError:function(a,c,e){this.name="SyntaxError";this.message=a;this.line=c;this.column=e}};a.SyntaxError.prototype=Error.prototype;return a}();
glift.controllers={controllerMap:{},create:function(a){a=glift.controllers.processOptions(a);if(a.controllerType in glift.controllers.controllerMap)return glift.controllers.controllerMap[a.controllerType](a);throw"No controller found for type: "+a.controllerType;}};
(function(){var a=glift.enums.controllerTypes.BASE;glift.controllers.createBaseController=function(){return new b};glift.controllers.controllerMap[a]=glift.controllers.createBaseController;var b=function(){};b.prototype={addStone:function(){throw"Not Implemented";},initialize:function(a){a=glift.rules;var b=this.sgfString;this.initPosition=a.treepath.parseInitPosition(this.initialPosition);this.movetree=a.movetree.getFromSgf(b,this.initPosition);this.goban=a.goban.getFromMoveTree(this.movetree,this.initPosition);
return this.getEntireBoardState()},getEntireBoardState:function(){return glift.rules.intersections.getFullBoardData(this.movetree,this.goban)},canAddStone:function(a,b){return this.goban.placeable(a,b)},getCurrentPlayer:function(){return this.movetree.getCurrentPlayer()},getIntersections:function(){return this.movetree.getIntersections()}}})();
glift.controllers.processOptions=function(a){var b=function(a){this.name="DisplayOptionError";this.message=a};b.prototype=Error();var c={controllerType:"STATIC_PROBLEM_STUDY",initialPosition:[],sgfString:""},e;for(e in a){var d=a[e];switch(e){case "controllerType":if("string"==glift.util.typeOf(d)&&d in glift.enums.controllerTypes)c.controllerType=d;else throw new b("Unknown controllerType: "+d);break;case "initialPosition":c.initialPosition=glift.rules.parseInitPosition(d);break;case "sgfString":if("string"===
glift.util.typeOf(d))c.sgfString=d;else throw new b("Bad type for sgfString: "+d);break;default:glift.util.logz("Unknown option key: "+e)}}return c};
(function(){var a=glift.util,b=glift.enums.controllerTypes.STATIC_PROBLEM_STUDY;glift.controllers.staticProblemStudy={_create:function(b){var d=glift.util.beget(glift.controllers.createBaseController()),d=a.setMethods(d,c);d.initOptions(b);return d}};glift.controllers.createStaticProblemStudy=function(a){a=glift.controllers.staticProblemStudy._create(a);a.initialize("foo");return a};glift.controllers.controllerMap[b]=glift.controllers.createStaticProblemStudy;var c={initOptions:function(a){this.sgfString=
a.sgfString||"";this.initialPosition=a.initialPosition;return this},addStone:function(b,d){var c=glift.enums.problemResults,g=glift.enums.controllerMessages,k=g.FAILURE,l=g.DONE,m=g.CONTINUE,n=c.CORRECT,p=c.INCORRECT,v=c.INDETERMINATE;if(!this.goban.addStone(b,d).successful)return{message:k,reason:"Cannot add stone"};k=this.movetree.findNextMove(b,d);this.lastPlayed={point:b,color:d};if(k===a.none)return{message:l,result:p};this.movetree.moveDown(k);var k=this.movetree.isCorrectPosition(),w=glift.rules.intersections.getFullBoardData(this.movetree,
this.goban);if(k===n)return{message:l,result:n,data:w};if(k===v)return c=glift.math.getRandomInt(0,this.movetree.getNode().numChildren()-1),this.movetree.moveDown(c),c=this.movetree.getProperties().getMove(),this.goban.addStone(c.point,c.color),w=glift.rules.intersections.getFullBoardData(this.movetree,this.goban),{message:m,result:v,data:w};if(k===c.INCORRECT)return{message:g.DONE,result:p};throw"Unexpected result output: "+k;}}})();
glift.bridge={setDisplayState:function(a,b){var c=glift.enums.marks,e;for(e in a.points){var d=a.points[e];c.STONE in d&&b.setColor(d.point,d[c.STONE])}}};
glift.bridge.getFromMovetree=function(a){var b=glift.displays.bboxFromPts,c=glift.util.point,e=glift.enums.boardRegions,d=a.getIntersections()-1,h=Math.ceil(d/2),g={},k={},l=0;g[e.TOP_LEFT]=b(c(0,0),c(h+1,h+1));g[e.TOP_RIGHT]=b(c(h-1,0),c(d,h+1));g[e.BOTTOM_LEFT]=b(c(0,h-1),c(h+1,d));g[e.BOTTOM_RIGHT]=b(c(h-1,h-1),c(d,d));a.recurseFromRoot(function(a){a=a.getProperties().getAllStones();for(var b in a)for(var c=a[b],d=0;d<c.length;d++){var e=c[d];l+=1;for(var h in g)g[h].contains(e)&&(void 0===k[h]&&
(k[h]=[]),k[h].push(e))}});return glift.bridge._getRegionFromTracker(k,l)};glift.bridge._getRegionFromTracker=function(a,b){var c=[],e;for(e in a){if(a[e].length===b)return e;c.push(e)}if(2!==c.length)return glift.boardRegions.ALL;var c=glift.util.intersection(glift.util.regions.getComponents(c[0]),glift.util.regions.getComponents(c[1])),d;for(d in c)return d;return glift.boardRegions.ALL};
