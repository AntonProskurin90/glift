<!DOCTYPE html>
<html>
<head>

<title> PerfTester </title>
<script type="text/javascript" src="../testdata/sgfs.js"></script>
<script type="text/javascript" src="../testdata/gogameguru_commentary.js"></script>

<!-- AUTO-GEN-DEPS -->
<!-- . sources -->
<script type="text/javascript" src=".././glift.js"></script>
<script type="text/javascript" src=".././global.js"></script>
<script type="text/javascript" src=".././init.js"></script>
<!-- util sources -->
<script type="text/javascript" src="../util/util.js"></script>
<script type="text/javascript" src="../util/array.js"></script>
<script type="text/javascript" src="../util/colors.js"></script>
<script type="text/javascript" src="../util/enums.js"></script>
<script type="text/javascript" src="../util/errors.js"></script>
<script type="text/javascript" src="../util/id_generator.js"></script>
<script type="text/javascript" src="../util/key_mappings.js"></script>
<script type="text/javascript" src="../util/math.js"></script>
<script type="text/javascript" src="../util/obj.js"></script>
<script type="text/javascript" src="../util/performance.js"></script>
<script type="text/javascript" src="../util/platform.js"></script>
<script type="text/javascript" src="../util/point.js"></script>
<script type="text/javascript" src="../util/regions.js"></script>
<!-- dom sources -->
<script type="text/javascript" src="../dom/dom.js"></script>
<script type="text/javascript" src="../dom/sanitize.js"></script>
<script type="text/javascript" src="../dom/ux.js"></script>
<!-- ajax sources -->
<script type="text/javascript" src="../ajax/ajax.js"></script>
<!-- themes sources -->
<script type="text/javascript" src="../themes/themes.js"></script>
<script type="text/javascript" src="../themes/base_theme.js"></script>
<script type="text/javascript" src="../themes/classes.js"></script>
<script type="text/javascript" src="../themes/colorful.js"></script>
<script type="text/javascript" src="../themes/css_base_theme.js"></script>
<script type="text/javascript" src="../themes/default.js"></script>
<script type="text/javascript" src="../themes/depth.js"></script>
<script type="text/javascript" src="../themes/moody.js"></script>
<script type="text/javascript" src="../themes/textbook.js"></script>
<script type="text/javascript" src="../themes/transparent.js"></script>
<!-- markdown sources -->
<script type="text/javascript" src="../markdown/markdown.js"></script>
<script type="text/javascript" src="../markdown/marked.js"></script>
<!-- displays sources -->
<script type="text/javascript" src="../displays/displays.js"></script>
<script type="text/javascript" src="../displays/board_points.js"></script>
<script type="text/javascript" src="../displays/cropbox_wrapper.js"></script>
<script type="text/javascript" src="../displays/environment.js"></script>
<script type="text/javascript" src="../displays/ids.js"></script>
<script type="text/javascript" src="../displays/line_box.js"></script>
<script type="text/javascript" src="../displays/resized_box.js"></script>
<!-- displays/board sources -->
<script type="text/javascript" src="../displays/board/board.js"></script>
<script type="text/javascript" src="../displays/board/board_base.js"></script>
<script type="text/javascript" src="../displays/board/board_labels.js"></script>
<script type="text/javascript" src="../displays/board/buttons.js"></script>
<script type="text/javascript" src="../displays/board/intersections.js"></script>
<script type="text/javascript" src="../displays/board/lines.js"></script>
<script type="text/javascript" src="../displays/board/marks.js"></script>
<script type="text/javascript" src="../displays/board/starpoints.js"></script>
<script type="text/javascript" src="../displays/board/stones.js"></script>
<!-- displays/commentbox sources -->
<script type="text/javascript" src="../displays/commentbox/commentbox.js"></script>
<script type="text/javascript" src="../displays/commentbox/create.js"></script>
<!-- displays/gui sources -->
<script type="text/javascript" src="../displays/gui/gui.js"></script>
<script type="text/javascript" src="../displays/gui/center.js"></script>
<!-- displays/icons sources -->
<script type="text/javascript" src="../displays/icons/icons.js"></script>
<script type="text/javascript" src="../displays/icons/bar.js"></script>
<script type="text/javascript" src="../displays/icons/icon_centering.js"></script>
<script type="text/javascript" src="../displays/icons/icon_selector.js"></script>
<script type="text/javascript" src="../displays/icons/svg.js"></script>
<script type="text/javascript" src="../displays/icons/wrapped_icon.js"></script>
<!-- displays/svg sources -->
<script type="text/javascript" src="../displays/svg/svg.js"></script>
<script type="text/javascript" src="../displays/svg/pathutils.js"></script>
<script type="text/javascript" src="../displays/svg/svgobj.js"></script>
<!-- displays/statusbar sources -->
<script type="text/javascript" src="../displays/statusbar/statusbar.js"></script>
<script type="text/javascript" src="../displays/statusbar/fullscreen.js"></script>
<script type="text/javascript" src="../displays/statusbar/gameinfo.js"></script>
<script type="text/javascript" src="../displays/statusbar/info_window.js"></script>
<!-- displays/position sources -->
<script type="text/javascript" src="../displays/position/position.js"></script>
<script type="text/javascript" src="../displays/position/widget_boxes.js"></script>
<script type="text/javascript" src="../displays/position/widget_positioner.js"></script>
<!-- rules sources -->
<script type="text/javascript" src="../rules/rules.js"></script>
<script type="text/javascript" src="../rules/all_properties.js"></script>
<script type="text/javascript" src="../rules/autonumber.js"></script>
<script type="text/javascript" src="../rules/goban.js"></script>
<script type="text/javascript" src="../rules/move.js"></script>
<script type="text/javascript" src="../rules/movenode.js"></script>
<script type="text/javascript" src="../rules/movetree.js"></script>
<script type="text/javascript" src="../rules/problems.js"></script>
<script type="text/javascript" src="../rules/properties.js"></script>
<script type="text/javascript" src="../rules/treepath.js"></script>
<!-- sgf sources -->
<script type="text/javascript" src="../sgf/sgf.js"></script>
<!-- parse sources -->
<script type="text/javascript" src="../parse/parse.js"></script>
<script type="text/javascript" src="../parse/sgf_parser.js"></script>
<script type="text/javascript" src="../parse/tygem.js"></script>
<!-- controllers sources -->
<script type="text/javascript" src="../controllers/controllers.js"></script>
<script type="text/javascript" src="../controllers/base.js"></script>
<script type="text/javascript" src="../controllers/board_editor.js"></script>
<script type="text/javascript" src="../controllers/game_figure.js"></script>
<script type="text/javascript" src="../controllers/game_viewer.js"></script>
<script type="text/javascript" src="../controllers/static_problem.js"></script>
<!-- orientation sources -->
<script type="text/javascript" src="../orientation/orientation.js"></script>
<script type="text/javascript" src="../orientation/bbox.js"></script>
<script type="text/javascript" src="../orientation/cropbox.js"></script>
<script type="text/javascript" src="../orientation/cropping.js"></script>
<script type="text/javascript" src="../orientation/min_bbox.js"></script>
<script type="text/javascript" src="../orientation/rotate.js"></script>
<!-- flattener sources -->
<script type="text/javascript" src="../flattener/flattener.js"></script>
<script type="text/javascript" src="../flattener/board.js"></script>
<script type="text/javascript" src="../flattener/flattened.js"></script>
<script type="text/javascript" src="../flattener/intersection.js"></script>
<script type="text/javascript" src="../flattener/symbols.js"></script>
<!-- widgets sources -->
<script type="text/javascript" src="../widgets/widgets.js"></script>
<script type="text/javascript" src="../widgets/base_widget.js"></script>
<script type="text/javascript" src="../widgets/manager.js"></script>
<!-- api sources -->
<script type="text/javascript" src="../api/api.js"></script>
<script type="text/javascript" src="../api/display_options.js"></script>
<script type="text/javascript" src="../api/hooks.js"></script>
<script type="text/javascript" src="../api/icon_actions.js"></script>
<script type="text/javascript" src="../api/options.js"></script>
<script type="text/javascript" src="../api/sgf_options.js"></script>
<script type="text/javascript" src="../api/stone_actions.js"></script>
<!-- api/widgetopt sources -->
<script type="text/javascript" src="../api/widgetopt/widgetopt.js"></script>
<script type="text/javascript" src="../api/widgetopt/board_editor.js"></script>
<script type="text/javascript" src="../api/widgetopt/correct_variations_problem.js"></script>
<script type="text/javascript" src="../api/widgetopt/example_options.js"></script>
<script type="text/javascript" src="../api/widgetopt/game_viewer.js"></script>
<script type="text/javascript" src="../api/widgetopt/reduced_game_viewer.js"></script>
<script type="text/javascript" src="../api/widgetopt/standard_problem.js"></script>
<!-- END-AUTO-GEN-DEPS -->
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      #glift_display1 {
        height:500px;
        width:100%;
        position:relative;
      }
      .perf-title {
        margin: 5px;
      }
      #gheader {
        border: 1px solid black;
        border-radius: 10px;
        box-shadow: 5px 5px 5px #888888;
        margin: 5px;
        padding: 5px;
      }
      #gheader table {
      }
      #gheader thead td {
        font-weight: bold;
        padding-right: 10px;
      }
      #gheader .perf-cell {
        padding-right: 10px;
      }
      p {
        margin: 10px;
        padding: 10px;
      }
    </style>
  </head>

  <body>
    <h1 class="perf-title"> Glift Performance Testing </h1>

    <div id="wrap" style="position:relative;">
      <div id="gheader">
      <table>
        <thead>
          <tr class="gheader-head">
            <td> Start (ms) </td>
            <td> End (ms) </td>
            <td> Runs </td>
            <td> Delta (ms) </td>
            <td> Average Time (ms) </td>
            <td> Description </td>
          </tr>
        </thead>
        <tbody id="gheader-body">
          <!-- Perf content goes here -->
        </tbody>
      </table>
      </div>
      <div id="glift_display1"></div>
      <div id="extra_info"></div>
      <script type="text/javascript">
        (function() {
          // Truncate to microsecond resolution
          var truncate = function(num) {
            return Math.round(num*10000)/10000.;
          };
          // Create a table cell element with some text.
          var td = function(text) {
            var tdElem = document.createElement('td');
            tdElem.setAttribute('class', 'perf-cell');
            tdElem.appendChild(document.createTextNode(text));
            return tdElem;
          };
          // Record a perf message.
          var recordPerf = function(start, end, runs, text) {
            var elem = document.getElementById('gheader-body');

            var row = document.createElement('tr');
            row.appendChild(td(truncate(start)));
            row.appendChild(td(truncate(end)));
            row.appendChild(td(truncate(runs)));
            row.appendChild(td(truncate((end - start))));
            row.appendChild(td(truncate((end - start)/runs)));
            row.appendChild(td(text));

            elem.appendChild(row);
          };
          var perfTest = function(desc, runs, fn) {
            var start = performance.now();
            for (var i = 0; i < runs; i++) {
              fn();
            }
            var end = performance.now();
            recordPerf(start, end, runs, desc);
          };

          var commentary = testdata.gogameguru_commentary;

          /////////////////////////////////////////////////////////////////
          // -------------------------- Tests -------------------------- //
          /////////////////////////////////////////////////////////////////

          perfTest('Iterate over all characters in a raw SGF', 1000, function() {
            for (var i = 0; i < commentary.length; i++) {
              var char = commentary.charAt(0);
            }
          });

          perfTest('Parse a movetree for a real game', 1000, function() {
            glift.parse.fromString(commentary);
          });

          var mt = glift.rules.movetree.getFromSgf(commentary, 200);
          perfTest('Add stones to goban from movetree', 10000, function() {
            var goban = glift.rules.goban.getInstance();
            goban.loadStonesFromMovetree(mt);
          });

          var keyGoban = glift.rules.goban.getInstance();
          keyGoban.loadStonesFromMovetree(mt);
          perfTest('Create a string key for a go board', 10000, function() {
            var out = '';
            for (var i = 0; i < keyGoban.intersections(); i++) {
              for (var j = 0; j < keyGoban.intersections(); j++) {
                // Note that string concatenation is much faster than using
                // arrays as buffers. Oh, javascript...
                out += '-' + keyGoban.getStone(glift.util.point(i, j));
              }
            }
          });

          mt = glift.rules.movetree.getFromSgf(commentary, 100);
          perfTest('Flatten a movetree with a next moves path', 1000, function() {
            var flattened = glift.flattener.flatten(mt, {
              nextMovesTreepath: [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
            });
          });

        })(); // End Perf Tests

      </script>
    </div>
  </body>
</html>
